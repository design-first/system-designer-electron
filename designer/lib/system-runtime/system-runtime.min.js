/*!
 * System Runtime
 * 
 * https://designfirst.io/systemruntime/
 * 
 * Copyright 2018 Erwan Carriou
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).runtime=e()}}(function(){var define,module,exports;return function o(i,s,d){function c(t,e){if(!s[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var a=s[t]={exports:{}};i[t][0].call(a.exports,function(e){return c(i[t][1][e]||e)},a,a.exports,o,i,s,d)}return s[t].exports}for(var l="function"==typeof require&&require,e=0;e<d.length;e++)c(d[e]);return c}({1:[function(e,t,n){"use strict";n.system={name:"system-runtime",master:!1,version:"2.8.3",description:"System Runtime",schemas:{"1ac07185641fa9f":{_name:"_Behavior",_inherit:["_Component"],_core:!0,core:"property",component:"property",action:"property",state:"property",useCoreAPI:"property",context:"property",_id:"1ac07185641fa9f"},"104ad1f48518376":{_id:"104ad1f48518376",_name:"_Channel",_inherit:["_Component"],_core:!0,send:"event",$systemInstalled:"event",$systemResolved:"event",$systemStarted:"event",$systemStopped:"event",$systemUninstalled:"event"},"1c00b13a1b1bc92":{_name:"_ClassInfo",_inherit:["_Component"],_core:!0,model:"property",schema:"property",method:"method",methods:"method",property:"method",properties:"method",link:"method",links:"method",collections:"method",collection:"method",event:"method",events:"method",_id:"1c00b13a1b1bc92"},"111df11e2b19fde":{_id:"111df11e2b19fde",_name:"_Component",_inherit:[],_core:!0,classInfo:"method",on:"method",off:"method",require:"method",destroy:"method",init:"method",error:"event"},"1723516a30132ac":{_name:"_Database",_inherit:["_Component"],_core:!0,collections:"method",insert:"event",update:"event",remove:"event",_id:"1723516a30132ac"},f1a10d1067d1b23a:{_id:"f1a10d1067d1b23a",_name:"_Log",_inherit:["_Component"],_core:!0,action:"property",collection:"property",id:"property",field:"property",value:"property",order:"property"},"1268f1dddd1fea7":{_name:"_Logger",_core:!0,level:"property",debug:"method",info:"method",warn:"method",error:"method",_id:"1268f1dddd1fea7"},"14caa1c46414ee1":{_name:"_Message",_inherit:["_Component"],_core:!0,event:"property",from:"property",data:"property",_id:"14caa1c46414ee1"},"193f1166eb16609":{_name:"_Metamodel",_inherit:["_Component"],_core:!0,schema:"method",model:"method",type:"method",create:"method",_id:"193f1166eb16609"},"157931f7a31b61d":{_id:"157931f7a31b61d",_name:"_OSGi",_inherit:["_Component"],_core:!0,install:"method",uninstall:"method",start:"method",stop:"method",status:"method",bundle:"method"},"12e211d4cd120a6":{_id:"12e211d4cd120a6",_name:"_Runtime",_inherit:["_OSGi"],_core:!0,version:"property",system:"method",message:"method",ready:"event"},"158711d6f215e4b":{_name:"_State",_inherit:[],_core:!0,_class:!1,state:"property",value:"property",_id:"158711d6f215e4b"},"1cb761fa4510dca":{_id:"1cb761fa4510dca",_name:"_System",_inherit:["_SystemOSGi"],_core:!0,name:"property",master:"property",version:"property",description:"property",schemas:"property",models:"property",behaviors:"property",types:"property",components:"property"},"145fe10c7514298":{_id:"145fe10c7514298",_name:"_SystemOSGi",_inherit:["_Component"],_core:!0,state:"property",location:"property",start:"method",stop:"method"}},models:{"166971fd9d107fd":{_name:"_Behavior",_core:!0,context:{type:"any",readOnly:!1,mandatory:!1,default:null},core:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},useCoreAPI:{type:"any",readOnly:!1,mandatory:!1,default:!1},component:{type:"string",readOnly:!1,mandatory:!0,default:""},action:{type:"javascript",readOnly:!1,mandatory:!0,default:""},state:{type:"string",readOnly:!1,mandatory:!0,default:""},_id:"166971fd9d107fd"},"135c71078810af2":{_id:"135c71078810af2",_name:"_Channel",_core:!0,send:{params:[{name:"message",type:"message"}]},$systemInstalled:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemResolved:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemUninstalled:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemStarted:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},$systemStopped:{params:[{name:"id",type:"string",mandatory:!0,default:""}]}},"158321dced1014a":{_name:"_ClassInfo",_core:!0,model:{type:"object",readOnly:!0,mandatory:!0,default:{}},property:{params:[{name:"name",type:"string"}],result:"object"},properties:{result:"array"},link:{params:[{name:"name",type:"string"}],result:"object"},links:{result:"array"},method:{params:[{name:"name",type:"string"}],result:"object"},methods:{result:"array"},collection:{params:[{name:"name",type:"string"}],result:"object"},collections:{result:"array"},event:{params:[{name:"name",type:"string"}],result:"object"},events:{result:"array"},_id:"158321dced1014a",schema:{type:"object",readOnly:!0,mandatory:!0,default:{}}},"123751cb591de26":{_id:"123751cb591de26",_name:"_Component",_core:!0,on:{params:[{name:"state",type:"string"},{name:"action",type:"function"},{name:"useCoreAPI",type:"any",mandatory:!1,default:!1},{name:"isCore",type:"boolean",mandatory:!1,default:!1}]},off:{params:[{name:"state",type:"string",mandatory:!1},{name:"behaviorId",type:"string",mandatory:!1}]},require:{params:[{name:"id",type:"string"}]},destroy:{params:[]},classInfo:{result:"_ClassInfo"},init:{params:[{name:"conf",type:"object"}]},error:{params:[{name:"data",type:"errorParam"}]}},"18a51169d7112d4":{_name:"_Database",_core:!0,collections:{result:"object"},insert:{params:[{name:"event",type:"dbInsertEvent"}]},update:{params:[{name:"event",type:"dbUpdateEvent"}]},remove:{params:[{name:"event",type:"dbRemoveEvent"}]},_id:"18a51169d7112d4"},o1e1e01e6b41cec3:{_id:"o1e1e01e6b41cec3",_name:"_Log",action:{type:"dbAction",readOnly:!1,mandatory:!1,default:"insert"},collection:{type:"string",readOnly:!1,mandatory:!1,default:""},id:{type:"string",readOnly:!1,mandatory:!1,default:""},field:{type:"string",readOnly:!1,mandatory:!1,default:""},value:{type:"any",readOnly:!1,mandatory:!1,default:""},order:{type:"number",readOnly:!1,mandatory:!1,default:0},_core:!0},"16b9d1ac2216ffe":{_id:"16b9d1ac2216ffe",_name:"_Logger",_core:!0,level:{type:"log",readOnly:!1,mandatory:!1,default:"warn"},debug:{params:[{name:"message",type:"any"}]},info:{params:[{name:"message",type:"any"}]},warn:{params:[{name:"message",type:"any"}]},error:{params:[{name:"message",type:"any"}]}},"1d9b6139411aa91":{_name:"_Message",_core:!0,event:{type:"string",readOnly:!1,mandatory:!0,default:""},from:{type:"string",readOnly:!1,mandatory:!0,default:""},data:{type:"array",readOnly:!1,mandatory:!0,default:[]},_id:"1d9b6139411aa91"},"1628c13c22152e6":{_name:"_Metamodel",_core:!0,schema:{params:[{name:"name",type:"any",default:"",mandatory:!1},{name:"schema",type:"object",default:{},mandatory:!1}],result:"any"},model:{params:[{name:"name",type:"any",default:"",mandatory:!1},{name:"model",type:"object",default:{},mandatory:!1}],result:"any"},type:{params:[{name:"name",type:"any",default:"",mandatory:!1},{name:"type",type:"object",default:{},mandatory:!1}],result:"any"},create:{params:[]},_id:"1628c13c22152e6"},"100b91ed2211b15":{_id:"100b91ed2211b15",_name:"_OSGi",install:{params:[{name:"url",type:"any",mandatory:!0,default:""},{name:"async",type:"boolean",mandatory:!1,default:!0}],result:"string"},uninstall:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},start:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},stop:{params:[{name:"id",type:"string",mandatory:!0,default:""}]},status:{result:"object"},_core:!0,bundle:{result:"string"}},"14c7c105b31a160":{_id:"14c7c105b31a160",_name:"_Runtime",_core:!0,version:{type:"string",readOnly:!0,mandatory:!0,default:"0.0.0"},system:{params:[{name:"params",type:"any",mandatory:!1}],result:"object"},message:{params:[{name:"msg",type:"message",mandatory:!0}]},ready:{}},"177ac136891629f":{_name:"_State",_core:!0,state:{type:"string",readOnly:!1,mandatory:!0,default:""},value:{type:"any",readOnly:!1,mandatory:!1,default:null},_id:"177ac136891629f"},"170521b88614387":{_name:"_System",_core:!0,name:{type:"string",readOnly:!1,mandatory:!0,default:""},master:{type:"boolean",readOnly:!1,mandatory:!1,default:!1},version:{type:"string",readOnly:!1,mandatory:!1,default:"0.0.1"},description:{type:"string",readOnly:!1,mandatory:!1,default:""},schemas:{type:"object",readOnly:!1,mandatory:!1,default:{}},models:{type:"object",readOnly:!1,mandatory:!1,default:{}},behaviors:{type:"object",readOnly:!1,mandatory:!1,default:{}},types:{type:"object",readOnly:!1,mandatory:!1,default:{}},components:{type:"object",readOnly:!1,mandatory:!1,default:{}},_id:"170521b88614387"},"1b2811b092143f5":{_id:"1b2811b092143f5",_name:"_SystemOSGi",start:{},stop:{},_core:!0,state:{type:"string",readOnly:!1,mandatory:!1,default:"none"},location:{type:"string",readOnly:!1,mandatory:!1,default:""}}},behaviors:{"12e491859c13918":{_id:"12e491859c13918",component:"_Channel",state:"$systemStarted",action:"function $systemStarted(id) { \n  var systems = null;\n    \n  if (id !== 'e89c617b6b15d24') {\n    if (typeof document !== 'undefined') {\n      systems = document.querySelectorAll('link[rel=system]');\n         \n      if ($state.get('runtime') && $state.get('runtime').state === 'ready') {    \n      } else {\n        if (systems.length + 1 === $db._System.count()) {\n          $component.get('runtime').ready();\n        }\n      }\n    }\n  }\n}",useCoreAPI:!0,core:!0},"1e9021bd4e1bc6e":{_id:"1e9021bd4e1bc6e",component:"_Channel",state:"$systemInstalled",action:"function $systemInstalled(id) {\n  var systems = null,\n    dependencies = [],\n    master = [],\n    canStart = true;\n\n  if (id !== 'e89c617b6b15d24') {\n    // if all systems are installed\n    systems = $db._System.find({});\n\n    systems.forEach(function (system) {\n      var sys = this.require(system._id);\n      if (sys && sys.state && sys.state() === 'none') {\n        canStart = false;\n      }\n    }.bind(this));\n\n    // start all the systems\n    if (canStart) {\n      dependencies = $db._System.find({\n        'master': false\n      });\n\n      dependencies.forEach(function (dep) {\n        var system = this.require(dep._id);\n        channel = this.require('channel');\n\n        if (system.state() === 'resolved') {\n          system.state('starting');\n          system.start();\n          channel.$systemStarted(dep._id);\n          system.state('active');\n        }\n      }.bind(this));\n\n      master = $db._System.find({\n        'master': true\n      });\n\n      master.forEach(function (dep) {\n        var system = this.require(dep._id);\n        channel = this.require('channel');\n\n        if (system && system.state && system.state() === 'resolved') {\n          system.state('starting');\n          system.start();\n          channel.$systemStarted(dep._id);\n          system.state('active');\n        }\n      }.bind(this));\n    }\n  }\n}",useCoreAPI:!0,core:!0},"155141e40312cd8":{_id:"155141e40312cd8",component:"_ClassInfo",state:"collection",action:"function collection(name) {\n  var result = {};\n  if (this.schema()[name] === 'collection') {\n    result = this.model()[name];\n  }\n\n  return result;\n}",core:!0},"1f6941a0c012c1f":{_id:"1f6941a0c012c1f",component:"_ClassInfo",state:"collections",action:"function collections(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'collection') {\n      result.push(item);\n    }\n  }\n\n  return result;\n}",core:!0},"1ef711b4171c849":{_id:"1ef711b4171c849",component:"_ClassInfo",state:"event",action:"function event(name) {\n  var result = {};\n\n  if (this.schema()[name] === 'event') {\n    result = this.model()[name];\n  }\n\n  return result;\n}",core:!0},"1bae51b6ed1d25c":{_id:"1bae51b6ed1d25c",component:"_ClassInfo",state:"events",action:"function events(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'event') {\n      result.push(item);\n    }\n  }\n  return result;\n}",core:!0},"19ac2125221528b":{_id:"19ac2125221528b",component:"_ClassInfo",state:"link",action:"function link(name) {\n  var result = {};\n\n  if (this.schema()[name] === 'link') {\n    result = this.model()[name];\n  }\n  return result;\n}",core:!0},"17ed21dfc01b8e8":{_id:"17ed21dfc01b8e8",component:"_ClassInfo",state:"links",action:"function links(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'link') {\n      result.push(item);\n    }\n  } return result;\n}",core:!0},"11ce318a561ac61":{_id:"11ce318a561ac61",component:"_ClassInfo",state:"method",action:"function method(name) {\n  var result = {};\n  if (this.schema()[name] === 'method') {\n    result = this.model()[name];\n  }\n  \n  return result;\n}",core:!0},"12ff2190a018046":{_id:"12ff2190a018046",component:"_ClassInfo",state:"methods",action:"function methods(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'method') {\n      result.push(item);\n    }\n  }\n\n  return result;\n}",core:!0},"1028d1681e1fd58":{_id:"1028d1681e1fd58",component:"_ClassInfo",state:"properties",action:"function properties(name) {\n  var keys = Object.keys(this.schema()),\n    item = '',\n    result = [],\n    i = 0,\n    length = keys.length;\n\n  for (i = 0; i < length; i++) {\n    item = keys[i];\n    if (this.schema()[item] === 'property') {\n      result.push(item);\n    }\n  } return result;\n}",core:!0},"18eeb10c5319368":{_id:"18eeb10c5319368",component:"_ClassInfo",state:"property",action:"function property(name) {\n  var result = {};\n\n  if (this.schema()[name] === 'property') {\n    result = this.model()[name];\n  }\n  return result;\n}",core:!0},"1ba721201114b6b":{_id:"1ba721201114b6b",component:"_Component",state:"destroy",action:"function destroy() {\n  $component.destroy(this.id());\n}",core:!0,useCoreAPI:!0},"15486186f41a48c":{_id:"15486186f41a48c",component:"_Component",state:"off",action:'function off(state, behaviorId) {\n  var args = [],\n    i = 0,\n    numInjectedParams = 8,\n    length = arguments.length;\n\n  if ($helper.isOnNode()) {\n    numInjectedParams = numInjectedParams +1;\n  }\n\n  for (i = 0; i < length - numInjectedParams; i++) {\n    args.push(arguments[i]);\n  }\n\n  if ($workflow.checkInput({\n    "component": this,\n    "methodName": "off",\n    "args": args\n  })) {\n\n    if (state || behaviorId) {\n      if ($metamodel.isValidState(state, this.constructor.name)) {\n        $behavior.remove({\n          "behaviorId": behaviorId,\n          "componentId": this.id(),\n          "state": state\n        });\n      } else {\n        this.require(\'logger\').warn("invoke \\\'off\\\' method of component \'" + this.id() + "\' with an invalid state \'" + state + "\'");\n      }\n    } else {\n      $behavior.remove({\n        "componentId": this.id()\n      });\n    }\n  }\n}',core:!0,useCoreAPI:!0},"1da0a17878104c3":{_id:"1da0a17878104c3",component:"_Component",state:"require",action:"function require(id) {\n  return $component.get(id);\n}",core:!0,useCoreAPI:!0},d152631c35813f2e:{_id:"d152631c35813f2e",component:"_Component",state:"classInfo",action:"function classInfo() { \n\tconst className = this.constructor.name;\n\tlet result;\n\t\n\tif (className !== 'Function') {\n\t  result = this.require(className + 'Info');\n\t}\n\t\n\treturn result;\n}",useCoreAPI:!1,core:!0},"1a5111d17a1800c":{_id:"1a5111d17a1800c",component:"_Database",state:"collections",action:"function collections() {\n  var result = {},\n    collectionName = '';\n\n  for (collectionName in $db.store) {\n    if ($db.store.hasOwnProperty(collectionName)) {\n      result[collectionName] = $db[collectionName];\n    }\n  }\n  return result;\n}",core:!0,useCoreAPI:!0},"1d993108fa18ef2":{_id:"1d993108fa18ef2",component:"_Logger",state:"debug",action:"function debug(message) {\n  if (this.level() === 'debug') {\n    console.log('runtime: ' + message);\n  }\n}",core:!0},"1a37a188e11fe73":{_id:"1a37a188e11fe73",component:"_Logger",state:"error",action:"function error(message) {\n  console.error('runtime: ' + message);\n}",core:!0},"1edd21e12a16534":{_id:"1edd21e12a16534",component:"_Logger",state:"info",action:"function info(message) {\n  if (this.level() === 'info' || this.level() === 'debug') {\n    console.info('runtime: ' + message);\n  }\n}",core:!0},"141f2143d3122a4":{_id:"141f2143d3122a4",component:"_Logger",state:"level",action:"function level(val) {\n  $log.level(val);\n}",core:!0,useCoreAPI:!0},"192401bab21304e":{_id:"192401bab21304e",component:"_Logger",state:"warn",action:"function warn(message) {\n  if (this.level() === 'info' || this.level() === 'warn' || this.level() === 'debug') {\n    console.warn('runtime: ' + message);\n  }\n}",core:!0},"11fc715e2f1a31e":{_id:"11fc715e2f1a31e",component:"_Metamodel",state:"create",action:"function create() {\n  $metamodel.create();\n}",core:!0,useCoreAPI:!0},"1232f1f107142cf":{_id:"1232f1f107142cf",component:"_Metamodel",state:"model",action:"function model(name, model) {\n  return $metamodel.model(name, model);\n}",core:!0,useCoreAPI:!0},"1365412f69153d2":{_id:"1365412f69153d2",component:"_Metamodel",state:"schema",action:"function schema(name, schema) {\n  return $metamodel.schema(name, schema);\n}",core:!0,useCoreAPI:!0},"194db147fe161a2":{_id:"194db147fe161a2",component:"_Metamodel",state:"type",action:"function type(name, type) {\n  return $metamodel.type(name, type);\n}",core:!0,useCoreAPI:!0},"1ef951f1411b895":{_id:"1ef951f1411b895",component:"_OSGi",state:"install",action:"function install(url, async) {\n  var importedSystem = null,\n    system = {},\n    systemId = '',\n    callbackLoad = null,\n    xhr = null,\n    result = '',\n    channel = $component.get('channel');\n\n  if (typeof url === 'object') {\n    importedSystem = url;\n  } else {\n    if (url.indexOf('{') === 0) {\n      importedSystem = JSON.parse(url);\n    }\n  }\n\n  if (importedSystem) {\n    systemId = $db.importSystem(importedSystem);\n    if (systemId) {\n      system = this.require(systemId);\n\n      if (typeof url === 'string') {\n        system.location(url);\n      }\n      system.state('installed');\n      channel.$systemInstalled(systemId);\n      system.state('resolved');\n      channel.$systemResolved(systemId);\n\n      result = systemId;\n    }\n  } else {\n    if (typeof global !== 'undefined' && typeof window === 'undefined') {\n      if (url.indexOf('.json') !== -1) {\n        system = require(global.process.env.PWD + '/' + url);\n      } else {\n        system = require(url);\n      }\n      systemId = $db.importSystem(system);\n      system = this.require(systemId);\n\n      if (typeof url === 'string') {\n        system.location(url);\n      }\n      system.state('installed');\n      channel.$systemInstalled(systemId);\n      system.state('resolved');\n      channel.$systemResolved(systemId);\n\n      result = systemId;\n    } else {\n      xhr = new XMLHttpRequest();\n      callbackLoad = function callbackLoad(system, url) {\n        var sysId = $db.importSystem(system),\n          sys = $component.get(sysId),\n          channel = $component.get('channel');\n\n        if (typeof url === 'string') {\n          sys.location(url);\n        }\n        sys.state('installed');\n        channel.$systemInstalled(sysId);\n        sys.state('resolved');\n        channel.$systemResolved(sysId);\n\n        result = sysId;\n      };\n\n      if (async) {\n        xhr.open('GET', url, true);\n        xhr.onreadystatechange = function () {\n          if (xhr.readyState === 4) {\n            if (xhr.status === 200 || xhr.status === 0) {\n              callbackLoad(JSON.parse(xhr.response), url);\n            }\n          }\n        };\n        xhr.send(null);\n      } else {\n        xhr.open('GET', url, false);\n        xhr.send(null);\n        if (xhr.status === 200 || xhr.status === 0) {\n          callbackLoad(JSON.parse(xhr.response), url);\n        }\n      }\n    }\n  }\n  return result;\n}",useCoreAPI:!0,core:!0},"14c1517b711cb78":{_id:"14c1517b711cb78",component:"_OSGi",state:"uninstall",action:"function uninstall(id) {\n  var search = {},\n    system = null,\n    behaviorId = '',\n    collection = '',\n    componentId = '',\n    length = 0,\n    i = 0,\n    coreComponents = ['admin', 'channel', 'db', 'logger', 'metamodel', 'runtime'];\n\n  search = $db._System.find({\n    '_id': id\n  });\n\n  if (search.length) {\n    system = search[0];\n    // remove behaviors\n    if (system.behaviors) {\n      for (behaviorId in system.behaviors) {\n        $db._Behavior.remove({\n          '_id': system.behaviors[behaviorId]._id\n        });\n      }\n    }\n    // remove components\n    if (system.components) {\n      for (collection in system.components) {\n        for (componentId in system.components[collection]) {\n          if (coreComponents.indexOf(componentId) === -1) {\n            $db[collection].remove({\n              '_id': componentId\n            });\n          }\n        }\n      }\n    }\n  }\n  if (this.require(id) && this.require(id).state) {\n    this.require(id).state('uninstalled');\n    this.require('channel').$systemUninstalled(id);\n  }\n}",useCoreAPI:!0,core:!0},"105f219c6813643":{_id:"105f219c6813643",component:"_OSGi",state:"start",action:"function start(id) {\n  var system = this.require(id),\n    channel = this.require('channel');\n\n  if (system.state() === 'resolved' || system.state() === 'installed') {\n    system.state('starting');\n    if (system.start) {\n      system.start();\n    }\n    channel.$systemStarted(id);\n    system.state('active');\n  }\n}",useCoreAPI:!1,core:!0},"1a81a1f00d17269":{_id:"1a81a1f00d17269",component:"_OSGi",state:"stop",action:"function stop(id) {\n  var system = this.require(id),\n    channel = this.require('channel');\n\n  if (system.state() === 'active') {\n    system.state('stopping');\n    if (system.stop) {\n      system.stop();\n    }\n    channel.$systemStopped(id);\n    system.state('resolved');\n    channel.$systemResolved(id);\n  }\n}",useCoreAPI:!1,core:!0},"116851b602128d1":{_id:"116851b602128d1",component:"_OSGi",state:"status",action:"function status() {\n  var result = {},\n    system = null,\n    length = 0,\n    i = 0;\n\n  systems = $db._System.find({});\n\n  length = systems.length;\n  for (i = 0; i < length; i++) {\n    system = systems[i];\n    result[system.name] = {\n      'id': system._id,\n      'state': system.state,\n      'name': system.name,\n      'version': system.version,\n      'location': system.location,\n      'master': system.master\n    };\n  }\n\n  return result;\n}",useCoreAPI:!0,core:!0},"19cf317d7217331":{_id:"19cf317d7217331",component:"_OSGi",state:"bundle",action:"function bundle() { \n\tvar result = $db.exportSystem();\n\treturn result;\n}",useCoreAPI:!0,core:!0},"13010167f313f87":{_id:"13010167f313f87",component:"_Runtime",state:"system",action:"function system(params) {\n  var RuntimeSystem = null,\n    system = {},\n    systemId = '',\n    result = [],\n    conf = {};\n\n  if (params) {\n    if (typeof params === 'string') {\n      conf.master = true;\n      conf.name = params;\n    } else {\n      conf = params;\n      conf.master = true;\n    }\n    RuntimeSystem = this.require('_System');\n    system = new RuntimeSystem(conf);\n    system.state('active');\n  } else {\n    result = $db._System.find({\n      'master': true\n    });\n    if (result.length) {\n      systemId = result[0]._id;\n      system = $component.get(systemId);\n    }\n  }\n  return system;\n}",core:!0,useCoreAPI:!0},"1cfa4145f614da8":{_id:"1cfa4145f614da8",component:"_Runtime",state:"message",action:"function message(msg) { \n  $db._Message.insert(msg);\n}",useCoreAPI:!0,core:!0},"1cb9d103d41dd97":{_id:"1cb9d103d41dd97",component:"e89c617b6b15d24",state:"start",action:"function start() {\n  if (typeof document !== 'undefined') {\n    document.addEventListener('DOMContentLoaded', function DOMContentLoaded(e) {\n      var systems = [],\n        system = null,\n        scripts = [],\n        script = null,\n        logLevel = 'warn',\n        i = 0,\n        length = 0;\n    \n      systems = document.querySelectorAll('link[rel=system]');\n      length = systems.length;\n  \n      // logger\n      scripts = document.querySelectorAll('script[log]');\n      if (scripts.length) {\n        logLevel = scripts[0].getAttribute('log');\n        this.require('logger').level(logLevel);\n      }\n  \n      // systems\n      for (i = 0; i < length; i++) {\n        system = systems[i];\n  \n        if (system.getAttribute('async') === 'false') {\n          this.require('runtime').install(system.href, false);\n        } else {\n          this.require('runtime').install(system.href, true);\n        }\n      }\n  \n      // ready event\n      if (length === 0) {\n        this.require('runtime').ready();\n      }\n  }.bind(this));\n  }\n}",useCoreAPI:!0,core:!0}},types:{css:{_id:"h1d88311ac019211",name:"css",type:"string",core:!0},date:{_id:"c17cad1bc3d17752",name:"date",type:"object",core:!0},json:{_id:"e1d25a12e67127ed",name:"json",type:"object",core:!0},dbInsertEvent:{_id:"148ef1e19810e6d",core:!0,name:"dbInsertEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},document:{type:"object",mandatory:!0,default:{}}}},dbRemoveEvent:{_id:"1952e1ac4213f4a",name:"dbRemoveEvent",type:"object",core:!0,schema:{collection:{type:"string",mandatory:!0,default:""},id:{type:"string",mandatory:!0,default:""}}},dbUpdateEvent:{_id:"1f5c41309711752",core:!0,name:"dbUpdateEvent",type:"object",schema:{collection:{type:"string",mandatory:!0,default:""},id:{type:"string",mandatory:!0,default:""},field:{type:"string",mandatory:!0,default:""},value:{type:"any",mandatory:!0,default:null}}},dbAction:{_id:"e1950e16f2914da9",core:!0,name:"dbAction",type:"string",value:["insert","update","remove"]},collection:{_id:"d1c0d0130c616199",name:"collection",type:"object",schema:{type:{type:["string"],mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"array",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},errorParam:{_id:"e198761fc0b1ae8a",name:"errorParam",type:"object",schema:{message:{type:"string",mandatory:!0},error:{type:"object",mandatory:!0}},core:!0},event:{_id:"g1668d1de2d1ff6f",name:"event",type:"object",schema:{params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},html:{_id:"y161c21320b11acb",name:"html",type:"string",core:!0},javascript:{_id:"s13d4c1fdf916504",name:"javascript",type:"string",core:!0},link:{_id:"p124601801d1dbfa",name:"link",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"{type}",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},log:{_id:"d1fd161a4a4149fc",name:"log",type:"string",value:["debug","info","warn","error"],core:!0},message:{_id:"l13b061ac571272d",name:"message",type:"object",schema:{event:{type:"string",mandatory:!0},from:{type:"string",mandatory:!1},data:{type:"array",mandatory:!0}},core:!0},method:{_id:"x1227218eed1f3e9",name:"method",type:"object",schema:{result:{type:"any",mandatory:!1},params:{type:["parameter"],mandatory:!1},description:{type:"string",mandatory:!1}},core:!0},osgiStates:{_id:"q1f0ca120fc13fb3",name:"osgiStates",type:"string",value:["none","installed","resolved","starting","active","stopping","uninstalled"],core:!0},parameter:{_id:"e1b18e16c6c195ad",name:"parameter",type:"object",schema:{description:{type:"string",mandatory:!1},name:{type:"string",mandatory:!0},type:{type:"any",mandatory:!0},mandatory:{type:"boolean",mandatory:!1},default:{type:"{type}",mandatory:!1}},core:!0},property:{_id:"a16a3a1ae051a55d",name:"property",type:"object",schema:{type:{type:"string",mandatory:!0},readOnly:{type:"boolean",mandatory:!0},mandatory:{type:"boolean",mandatory:!0},default:{type:"{type}",mandatory:!0},description:{type:"string",mandatory:!1},label:{type:"string",mandatory:!1}},core:!0},text:{_id:"c136fc129a912f54",name:"text",type:"string",core:!0}},components:{_Channel:{channel:{_id:"channel"}},_Database:{db:{_id:"db"}},_Logger:{logger:{_id:"logger",level:"warn"}},_Metamodel:{metamodel:{_id:"metamodel"}},_Runtime:{runtime:{_id:"runtime",version:"2.8.3"}}},_id:"e89c617b6b15d24"}},{}],2:[function(e,t,n){"use strict";var d=e("./db.js"),m=e("./helper.js"),a=e("./mson.js"),c={};function l(e,t,n,r){var a=-1,o=[],i="",s="",d=!0,c=!1,l=e;return-1!==l.indexOf(".")&&(l=e.split(".")[e.split(".").length-1]),0===t.trim().indexOf("function")&&(d=!1),d?(a=t.indexOf("=>"),(-1!==(s=(s=t.substring(0,a)).replace("=>","")).indexOf("(")?s.split("(")[1].replace(")","").trim():s.trim()).split(",").forEach(function(e){o.push(e.trim())}),0===(i=t.substring(a+2,t.length).trim()).indexOf("{")&&(i=i.substring(1,i.lastIndexOf("}")).trim()),-1===i.indexOf("\n")&&(c=!0),d&&c&&-1===i.indexOf("return ")&&(i="return "+i)):(a=t.indexOf("{"),(s=t.substring(0,a)).split("(")[1].replace(")","").trim().split(",").forEach(function(e){o.push(e.trim())}),i=(i=t.substring(a+1)).substring(0,i.lastIndexOf("}")).trim()),i=i.replace(/_this/g,"this"),""===o[0]&&(o=[]),r&&(o.push("$component"),o.push("$db"),o.push("$metamodel"),o.push("$workflow"),o.push("$behavior"),o.push("$state"),o.push("$log"),o.push("$helper")),m.isOnNode()&&o.push("require"),""!==o[0]?new Function("__action","return function "+l+" ("+o.join(", ")+") { return new Function('"+o.join("', '")+"', __action).apply(this, arguments) };")(i):new Function("__action","return function "+l+" () { return new Function(__action).apply(this, arguments) };")(i)}n.add=function(e,t,n,r,a,o){var i=m.generateId(),s=n.toString();return void 0===a&&(a=!1),void 0===r&&(r=!1),n=l(t,s,0,r),c[i]=n,d._Behavior.insert({_id:i,component:e,state:t,action:s,useCoreAPI:r,core:a,context:o}),i},n.remove=function(e){(e=e||{}).behaviorId=e.behaviorId||"",e.componentId=e.componentId||"",e.state=e.state||"",e.componentId&&(e.behaviorId?(d._Behavior.remove({_id:e.behaviorId,component:e.componentId,state:e.state}),delete c[e.behaviorId]):(e.state?d._Behavior.remove({component:e.componentId,state:e.state}):d._Behavior.remove({component:e.componentId})).forEach(function(e){delete c[e]}))},n.removeFromMemory=function(e){delete c[e]},n.getActions=function(e,t){var n=[],r=null;return d._Behavior.find({component:e,state:t}).forEach(function(e){void 0===(r=c[e[a.ID]])&&(r=l(e.state,e.action,e.core,e.useCoreAPI),c[e[a.ID]]=r),n.push({useCoreAPI:e.useCoreAPI,context:e.context,action:r})}),n},n.clear=function(){c={}},n.get=function(e){return c[e]}},{"./db.js":4,"./helper.js":5,"./mson.js":8}],3:[function(e,t,g){"use strict";var v=e("./workflow.js"),b=e("./db.js"),_=e("./metamodel.js"),O=e("./behavior.js"),I=e("./helper.js"),k=e("./log.js"),c=e("./state.js"),l=e("./mson.js"),h={};function S(a){var s,d,c,l,m,r=[],u=[],p=!1;function y(){var t=0,e=0,n=r.length;for(u.forEach(function(e){r[t]=m?I.getRuntime().require(e):e,t+=1}),e=t;e<n;e++)delete r[e];r.length=u.length}function f(e,t,n,r){var a=0,o=0,i=[];if(p)k.readOnlyProperty(d,c,l);else if(m)if(e&&_.inheritFrom(e.constructor.name,s)){switch(!0){case"push"===t:u.push(e.id());break;case"unshift"===t:u.unshift(e.id());break;case"splice"===t:for(o=(i=u.splice(n,r,e)).length,a=0;a<o;a++)v.process({component:d,state:l,data:[h[i[a]],"remove"]})}I.isRuntime()&&I.getRuntime().require("db").update({collection:c,id:d,field:l,value:u}),v.process({component:d,state:l,data:[e,"add"]})}else k.invalidPropertyName(d,c,l,e,s);else if(e&&_.isValidType(e,s)){switch(!0){case"push"===t:u.push(e);break;case"unshift"===t:u.unshift(e);break;case"splice"===t:u.splice(n,r,e)}I.isRuntime()&&I.getRuntime().require("db").update({collection:c,id:d,field:l,value:u}),v.process({component:d,state:l,data:[e,"add"]})}else k.invalidPropertyName(d,c,l,e,s);return u.length}function n(e){var t,n=null;if(p)k.readOnlyProperty(d,c,l);else if(0!==u.length){switch(!0){case"pop"===e:n=u.pop();break;case"shift"===e:n=u.shift()}I.isRuntime()&&I.getRuntime().require("db").update({collection:c,id:d,field:l,value:u}),t=m?h[n]:n,v.process({component:d,state:l,data:[t,"remove"]})}return t}return s=(a=a||{}).type||"",d=a.id||"",l=a.propertyName||"",u=a.arr||[],c=a.classId||"",void 0!==a.readOnly&&(p=a.readOnly),m=_.isClassName(s),u.forEach(function(e){m?r.push(I.getRuntime().require(e)):r.push(e)}),r.push=function(e){var t=f(e,"push");return r[r.length]=e,t},r.pop=function(){var e=n("pop"),t=r.length;return 0!==t&&(delete r[t],r.length=t-1),e},r.shift=function(){var e=n("shift");return y(),e},r.unshift=function(e){var t=f(e,"unshift");return y(),t},r.concat=function(e){var t,n=0,r=0;if(Array.isArray(e))for(r=e.length,n=0;n<r;n++)f(e[n],"push");return a.arr=u,t=new S(a),y(),t},r.sort=function(e){var t;return u.sort(e),I.isRuntime()&&I.getRuntime().require("db").update({collection:c,id:d,field:l,value:u}),t=r,y(),t},r.reverse=function(){return u.reverse(),I.isRuntime()&&I.getRuntime().require("db").update({collection:c,id:d,field:l,value:u}),y(),r},r.splice=function(e,t,n){var r=[],a=0,o=0,i=null;if(void 0!==n)f(n,"splice",e,t);else for(r=u.splice(e,t),I.isRuntime()&&I.getRuntime().require("db").update({collection:c,id:d,field:l,value:u}),o=r.length,a=0;a<o;a++)i=m?h[r[a]]:r[a],v.process({component:d,state:l,data:[i,"remove"]});return y(),r},r.slice=function(e,t){var n=u.slice(e,t);return y(),n},r}function d(e,t){var n,r=[],a=0,o=0;if(n=_.getModel(e)[t].params)for(a=n.length,o=0;o<a;o++)r.push(n[o].name);return r}function w(e,t,n){var r=null,a=b.store[e][t],o=n.split("."),i=o.length,s=0,d="",c=-1;for(r=a,s=0;s<i;s++)-1!==o[s].indexOf("[")?(d=o[s].split("[")[0],c=o[s].split("[")[1].replace("]",""),r=r[d][c]):r&&(r=r[o[s]]);return r}function N(e,t,n,r){var a=null,o=b.store[e][t],i=n.split("."),s=i.length,d=0,c="",l=-1;for(a=o,d=0;d<s-1;d++)-1!==i[d].indexOf("[")?(c=i[d].split("[")[0],l=i[d].split("[")[1].replace("]",""),a=a[c][l]):a=a[i[d]];a[i[d]]=r}function i(f,n,h){(function(e){var t,n,r,a,o=0,i=[];for(t=_.getModel(e),n=_.getSchema(t[l.NAME]),a=(r=Object.keys(n)).length,o=0;o<a;o++)n[r[o]]!==l.LINK_TYPE&&n[r[o]]!==l.PROPERTY_TYPE&&n[r[o]]!==l.COLLECTION_TYPE||i.push({name:r[o],type:t[r[o]].type,readOnly:t[r[o]].readOnly});return i})(f).forEach(function(e){var u,p,y,t={};u=e.name,p=e.type,y=e.readOnly,Array.isArray(p)||"array"===p?(t=function(e,t){var n,r,a,o,i,s,d=[],c=null,l=null,m=null;if(void 0===t){if(void 0===e)return new S({id:this.id(),propertyName:u,readOnly:y,classId:h,type:"array"===p?"any":p[0],arr:b.store[h][this.id()][u]});if(Array.isArray(e))o=e,i="array"===p?"any":p[0],s=!0,o.forEach(function(e){_.isValidType(e,i)&&_.inheritFrom(e.constructor.name,i)&&_.isClassName(i)||(s=s&&!1)}),(d=b[h].find({_id:this.id()})).length&&(c=d[0],n=e,r="array"===p?"any":p[0],a=[],n.forEach(function(e){if(_.isClassName(r))switch(!0){case"string"==typeof e:a.push(e);break;case void 0!==e.id:a.push(e.id());break;default:a.push(null)}else a.push(e)}),m=a,v.process({component:this.id(),state:u,data:[e,"reset"]}),c[u]=m,I.isRuntime()&&I.getRuntime().require("db").update({collection:h,id:this.id(),field:u,value:c[u]}));else if("number"==typeof e){if(l=b.store[h][this.id()][u][e]){switch(!0){case _.isClassName("array"===p?"array":p[0]):m=I.getRuntime().require(l);break;case"array"===p?"array":"date"===p[0]:m=new Date(l);break;case _.isStructure(u,f):m=j("",u+"["+e+"]",f,this.id());break;default:m=l}return m}}else k.invalidPropertyName(this.id(),this.constructor.name,u,e,"number")}else if(y)k.readOnlyProperty(this.id(),this.constructor.name,u);else if(_.isValidType(t,"array"===p?"any":p[0])||_.inheritFrom(t.constructor.name,"array"===p?"array":p[0])&&_.isClassName("array"===p?"array":p[0])){if((d=b[h].find({_id:this.id()})).length){switch(!0){case _.isClassName("array"===p?"array":p[0]):switch(!0){case"string"==typeof t:m=t;break;case void 0!==t.id:m=t.id();break;default:m=""}break;case!!Array.isArray(p)&&p[0]:m="string"==typeof t?t:t.toISOString();break;default:m=""}(c=d[0])[u][e]=m,I.isRuntime()&&I.getRuntime().require("db").update({collection:h,id:this.id(),field:u,value:c[u]}),v.process({component:this.id(),state:u,data:[t,"add"]})}}else k.invalidPropertyName(this.id(),this.constructor.name,u,t,p[0])},n.prototype[u]=new Function("__proxy","return function "+u+" (position, value) { return __proxy.apply(this, arguments) };")(t)):(t=function(e){var t=[],n=null,r=null;if(void 0===e){if(n=b.store[h][this.id()]){switch(!0){case _.isClassName(p):r=g.get(n[u]);break;case"date"===p:r=new Date(n[u]);break;case"json"===p:r=n[u],r=JSON.parse(JSON.stringify(r));break;case"array"===p:r=new S({id:this.id(),propertyName:u,readOnly:y,classId:h,type:"any",arr:b.store[h][this.id()][u]});break;case _.isStructure(u,h):r=j("",u,f,this.id());break;default:r=n[u]}return r}k.destroyedComponentCall(u,this.id())}else if(y)k.readOnlyProperty(this.id(),this.constructor.name,u);else if(_.isValidType(e,p)){if((t=b[h].find({_id:this.id()})).length){switch(n=t[0],!0){case _.isClassName(p):n[u]=null===e?e:e.id();break;case"date"===p:n[u]="string"==typeof e?e:e.toISOString();break;default:n[u]=e}I.isRuntime()&&I.getRuntime().require("db")&&I.getRuntime().require("db").update({collection:h,id:this.id(),field:u,value:e}),"_Behavior"===h&&O.removeFromMemory(this.id()),v.process({component:this.id(),state:u,data:[e]})}}else k.invalidPropertyName(this.id(),this.constructor.name,u,e,p)},n.prototype[u]=new Function("__proxy","return function "+u+" (value) { return __proxy.apply(this, arguments) };")(t))})}function j(p,y,f,h){var e,t,n,r,a,o=(e=p?p+"."+y:y,t=f,r=null,a=[],n=_.getModelPathType(t,e),(r=_.getType(n))&&r.schema&&Object.keys(r.schema).forEach(function(e){r.schema[e].name=e,a.push(r.schema[e])}),a),i=void 0;return w(f,h,p?p+"."+y:y)&&(i={},o.forEach(function(c){var l,m,u,e={};l=c.name,m=c.type,u=c.readOnly,Array.isArray(m)||"array"===m?(e=function(e,t){var n,r,a,o=null,i="",s="";if(s=(i=p?p+"."+y:y)+"."+l,void 0===t){if(void 0===e)return new S({id:h,propertyName:s,readOnly:u,classId:f,type:Array.isArray(m)?m[0]:"any",arr:w(f,h,s)});if(Array.isArray(e))n=e,r=Array.isArray(m)?m[0]:"any",a=!0,n.forEach(function(e){_.isValidType(e,r)||(a=a&&!1)}),a?b[f].find({_id:h}).length&&(N(f,h,s,e),-1!==s.indexOf("[")&&v.process({component:h,state:s.replace(/\[(\d)*\]/g,""),data:[e,"reset"]}),v.process({component:h,state:s,data:[e,"reset"]}),I.isRuntime()&&I.getRuntime().require("db").update({collection:f,id:h,field:s,value:e})):k.invalidPropertyName(h,this.constructor.name,l,e,m[0]);else if("number"==typeof e){if(b.store[f][h]){switch(!0){case _.isClassName(Array.isArray(m)?m[0]:"any"):return o=g.get(w(f,h,s+"["+e+"]"));case!!Array.isArray(m)&&m[0]:return o=new Date(w(f,h,s+"["+e+"]"));case!!Array.isArray(m)&&m[0]:return o=w(f,h,s+"["+e+"]"),o=JSON.parse(JSON.stringify(o));case _.isStructure(s,f):return o=j(i,l+"["+e+"]",f,h);default:return o=w(f,h,s+"["+e+"]")}return void 0===o&&void 0!==c.default&&(o=c.default),o}k.destroyedComponentCall(s[e]+"["+e+"]",h)}else k.invalidPropertyName(h,this.constructor.name,l,e,"number")}else if(u)k.readOnlyProperty(h,this.constructor.name,l);else if(_.isValidType(t,Array.isArray(m)?m[0]:"any")){if(b[f].find({_id:h}).length){var d=w(f,h,s);switch(void 0===d&&(d=[]),!0){case _.inheritFrom(t.constructor.name,Array.isArray(m)?m[0]:"any")&&_.isClassName(Array.isArray(m)?m[0]:"any"):d[e]=t.id();break;case!!Array.isArray(m)&&m[0]:d[e]=t.toISOString();break;default:d[e]=t}N(f,h,s,d),I.isRuntime()&&I.getRuntime().require("db").update({collection:f,id:h,field:s,value:d}),-1!==s.indexOf("[")&&v.process({component:h,state:s.replace(/\[(\d)*\]/g,""),data:[t,"add"]}),v.process({component:h,state:s,data:[t,"add"]})}}else k.invalidPropertyName(h,this.constructor.name,l,t,Array.isArray(m)?m[0]:"any")},i[l]=new Function("__proxy","return function "+l+" (position, value) { return __proxy.apply(this, arguments) };")(e)):(e=function(e){var t=[],n=null,r="",a="";if(a=(r=p?p+"."+y:y)+"."+l,void 0===e){if(b.store[f][h]){switch(!0){case _.isClassName(m):n=g.get(w(f,h,a));break;case"date"===m:n=new Date(w(f,h,a));break;case"json"===m:n=w(f,h,a),n=JSON.parse(JSON.stringify(n));break;case _.isStructure(a,f):n=j(r,l,f,h);break;default:n=w(f,h,a)}return void 0===n&&void 0!==c.default&&(n=c.default),n}k.destroyedComponentCall(a,h)}else if(u)k.readOnlyProperty(h,f,a);else if(_.isValidType(e,m)){if((t=b[f].find({_id:h})).length){switch(t[0],!0){case _.isClassName(m):N(f,h,a,e.id());break;case"date"===m:N(f,h,a,e.toISOString());break;default:N(f,h,a,e)}I.isRuntime()&&I.getRuntime().require("db")&&I.getRuntime().require("db").update({collection:f,id:h,field:a,value:e}),"_Behavior"===f&&O.removeFromMemory(h),-1!==a.indexOf("[")&&v.process({component:h,state:a.replace(/\[(\d)*\]/g,""),data:[e]}),v.process({component:h,state:a,data:[e]})}}else k.invalidPropertyName(h,f,a,e,m)},i[l]=new Function("__proxy","return function "+l+" (value) { return __proxy.apply(this, arguments) };")(e))})),i}function m(e,i,s){(function(e){var t,n,r,a,o=0,i=[];for(t=_.getModel(e),n=_.getSchema(t[l.NAME]),a=(r=Object.keys(n)).length,o=0;o<a;o++)n[r[o]]===l.METHOD_TYPE&&i.push(r[o]);return i})(e).forEach(function(n){var e=d(s,n),t=e.join(", "),r="",a=function(){return v.process({component:this.id(),state:n,data:arguments})},o=function(){var e=null,t=Array.prototype.slice.call(arguments);return t.shift(),arguments[0]?e=v.process({component:this.id(),state:n,data:t,context:arguments[0]}):k.unknownContext(s,n),e};t?(e.unshift("context"),r=e.join(", "),i.prototype[n]=new Function("__proxy","return function "+n+" ("+t+") { return __proxy.apply(this, arguments) };")(a),"name"!==n&&(i[n]=new Function("__proxy","return function "+n+" ("+r+") { return __proxy.apply(this, arguments) };")(o))):(i.prototype[n]=new Function("__proxy","return function "+n+" () { return __proxy.apply(this) };")(a),"name"!==n&&(i[n]=new Function("__proxy","return function "+n+" (context) { return __proxy.apply(this, arguments) };")(o)))})}function u(e,n,s){(function(e){var t,n,r,a,o=0,i=[];for(t=_.getModel(e),n=_.getSchema(t[l.NAME]),a=(r=Object.keys(n)).length,o=0;o<a;o++)n[r[o]]===l.EVENT_TYPE&&i.push(r[o]);return i})(e).forEach(function(i){var e=d(s,i).join(", "),t=function(){var e=[],t="e89c617b6b15d24",n=[],r=0,a=-1,o={};if("_Channel"===s){for((e=b._System.find({master:!0})).length&&(t=e[0][l.ID]),o.from=t,a=arguments.length,r=0;r<a;r++)n.push(arguments[r]);o.data=n,o.event=i,b._Message.insert(o),v.process({component:this.id(),state:"send",data:[{event:o.event,from:o.from,data:o.data}]})}else v.process({component:this.id(),state:i,data:arguments})};n.prototype[i]=e?new Function("__proxy","return function "+i+" ("+e+") { return __proxy.apply(this, arguments) };")(t):new Function("__proxy","return function "+i+" () { return __proxy.apply(this) };")(t)})}function n(e){var n,t,r,s,d,a={},o="";return o=void 0===(e=e||{}).model?I.generateId():e.model,n=o,a=new Function("__proxy","return function "+n+" (config) { __proxy.apply(this, arguments) };")(function(e){var t={};"Object"!==(e=e||{}).constructor.name&&(k.invalidConctructorParameters(e,n),e={}),_.isValidObject(e,_.getModel(n),!0,!0)||k.invalidParameters(n),_.prepareObject(e,_.getModel(n)),void 0===e[l.ID]&&(e[l.ID]=I.generateId()),t=function(){return e[l.ID]},(h[e[l.ID]]=this).id=new Function("__proxy","return function id () { return __proxy.apply(this) };")(t),b.store[n][e[l.ID]]=e,b.createLog("insert",n,e[l.ID],"",e),I.isRuntime()&&I.getRuntime().require("db")&&I.getRuntime().require("db").insert({collection:n,document:e}),Object.freeze(this),this.init&&this.init(e)}),h[o]=a,t=o,a.id=new Function("__proxy","return function id () { return __proxy.apply(this) };")(function(){return t}),i(e.model,a,o),m(e.model,a,o),u(e.model,a,o),_.inheritFrom(o,"_Component")&&(d=o,a.prototype.on=new Function("__proxy","return function on (state, action, useCoreAPI, isCore) { return __proxy.apply(this, arguments) };")(function(e,t,n,r){var a="",o="",i=null;return n&&n.constructor&&"Boolean"!==n.constructor.name&&(i=n,r=!(n=!1)),v.checkInput({component:this,methodName:"on",args:arguments})&&(_.isValidState(e,d)?_.isEvent(e,d)||_.isProperty(e,d)||_.isLink(e,d)||_.isCollection(e,d)||!(1<=b._Behavior.find({component:this.id(),state:e}).length)?v.checkInputNumbers(d,e,t)?(a=O.add(this.id(),e,t,n,r,i),(o=c.get(this.id()))&&o.state===e&&v.process({id:a,data:o.value})):k.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):k.behaviorNotUnique(d,e):k.invalidStateOn(d,e)),a}),s=o,a.on=new Function("__proxy","return function on (state, action, useCoreAPI, isCore) { return __proxy.apply(this, arguments) };")(function(e,t,n,r){var a="",o="",i=null;return n&&n.constructor&&"Boolean"!==n.constructor.name&&(i=n,r=!(n=!1)),v.checkInput({component:this,methodName:"on",args:arguments})&&(_.isValidState(e,s)?_.isEvent(e,s)||_.isProperty(e,s)||_.isLink(e,s)||_.isCollection(e,s)||!(1<=b._Behavior.find({component:this.id(),state:e}).length)?v.checkInputNumbers(s,e,t)?(a=O.add(this.id(),e,t,n,r,i),(o=c.get(this.id()))&&o.state===e&&v.process({id:a,data:o.value})):k.invalidParamNumberMethodOn(this.id(),this.constructor.name,e):k.behaviorNotUnique(s,e):k.invalidStateOn(s,e)),a}),r=o,a.off=new Function("__proxy","return function off (state, behaviorId) { return __proxy.apply(this, arguments) };")(function(e,t){v.checkInput({component:this,methodName:"off",args:arguments})&&(_.isValidState(e,r)?O.remove({behaviorId:t,componentId:r,state:e}):k.invalidStateOff(r,e))}),a.require=new Function("__proxy","return function require (id) { return __proxy.apply(this, arguments) };")(function(e){return g.get(e)}),a.init=new Function("__proxy","return function init (conf) { return __proxy.apply(this, arguments) };")(function(){}),a.destroy=new Function("__proxy","return function destroy () { return __proxy.apply(this) };")(function(){var e,t=this.id(),n=[],r=0;for(b[t]&&(n=b[t].remove()),delete h[t],O.remove({componentId:t}),e=n.length,r=0;r<e;r++)O.remove({componentId:n[r]});v.process({component:t,state:"destroy"})}),a.classInfo=new Function("__proxy","return function classInfo () { return __proxy.apply(this) };")(function(){return g.get(this.id()+"Info")})),Object.freeze(a),a}S.prototype=[],g.get=function(e){return h[e]},g.create=function(e){return n(e)},g.destroy=function(e){var t=h[e],n="";t&&(delete h[e],n=t.constructor.name,b[n].remove({_id:e}),O.remove({componentId:e}),"_Behavior"===n&&O.removeFromMemory(e))},g.removeFromMemory=function(e){delete h[e]},g.clear=function(){h={}}},{"./behavior.js":2,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./mson.js":8,"./state.js":10,"./workflow.js":11}],4:[function(e,t,y){"use strict";var l=e("./component.js"),m=e("./metamodel.js"),u=e("./helper.js"),p=e("./log.js"),n=e("./behavior.js"),r=e("./state.js"),f=e("./workflow.js"),h=e("./mson.js"),g=[],a=["_Runtime","_Schema","_Model","_GeneratedModel","_Behavior","_State","_Type","_Metamodel","_Database","_System","_ClassInfo","_Message","_Channel","_Logger","_Log"],o=["_Log","_Schema","_Logger","_Model","_GeneratedModel","_State","_Type"],i=0;function s(){var e=[];return e.sort=function(n){var r="",t=[];return e.forEach(function(e){t.push(e)}),n instanceof Function?t.sort(n):(r=Object.keys(n)[0],t.sort(function(e,t){return e[r]<t[r]?1===n[r]?-1:1:e[r]>t[r]?1===n[r]?1:-1:0})),t},e}function d(e,t,n){var r=!0,a="";e:for(a in t)switch(!0){case"$eq"===a:if(t[a]instanceof RegExp){if(null===n[e].toString().match(t[a])){r=!1;break e}}else if(n[e]!==t[a]){r=!1;break e}break;case"$gt"===a:if(n[e]<=t[a]){r=!1;break e}break;case"$gte"===a:if(n[e]<t[a]){r=!1;break e}break;case"$lt"===a:if(n[e]>=t[a]){r=!1;break e}break;case"$lte"===a:if(n[e]>t[a]){r=!1;break e}break;case"$ne"===a:if(n[e]===t[a]){r=!1;break e}break;case"$in"===a:if(Array.isArray(t[a])&&-1===t[a].indexOf(n[e])){r=!1;break e}break;case"$nin"===a:if(Array.isArray(t[a])&&-1!==t[a].indexOf(n[e])){r=!1;break e}}return r}function c(e,t){var n=!0,r=!1,a="",o=0,i=0;e:for(a in e){if(void 0===t[a]){n=!1;break}switch(!0){case e[a]instanceof RegExp:if(Array.isArray(t[a])&&!Array.isArray(e[a])){for(i=t[a].length,o=0;o<i;o++)if(null!==t[a][o].toString().match(e[a])){r=!0;break e}n=r}else if(null===t[a].toString().match(e[a])){n=!1;break e}break;case e[a]instanceof Object&&!Array.isArray(e[a]):n=d(a,e[a],t);break;case Array.isArray(t[a])&&!Array.isArray(e[a]):if(-1===t[a].indexOf(e[a])){n=!1;break e}break;default:if(t[a]!==e[a]){n=!1;break e}}}return n}function v(){var e,t="",n="",r=null,a=null,o=null,i={};if((e=y._System.find({master:!0})).length){for(n in r=(o=e[0])[h.ID],i[h.ID]=r,i.name=o.name,i.description=o.description,i.version=o.version,i.master=!0,a=function(){var e,t={},n="",r="",a="",o=null,i=null,s=null,d=null,c=null,l="",m="",u=0,p="";if(t.schemas={},y._Schema.count())for(l in y.store._Schema)y.store._Schema[l][h.CORE]||(s=JSON.parse(JSON.stringify(y.store._Schema[l])),t.schemas[l]=s);if(t.models={},y._Model.count())for(m in y.store._Model)y.store._Model[m][h.CORE]||(d=JSON.parse(JSON.stringify(y.store._Model[m])),t.models[m]=d);if(t.types={},y._Type.count())for(a in y.store._Type)y.store._Type[a].core||(o=JSON.parse(JSON.stringify(y.store._Type[a])),t.types[o.name]=o);for(r in t.behaviors={},y.store._Behavior)y.store._Behavior[r].core||(i=JSON.parse(JSON.stringify(y.store._Behavior[r])),t.behaviors[r]=i);for(t.components={},e=g.length,u=0;u<e;u++)if(n=g[u],y[n].count()){for(p in c=JSON.parse(JSON.stringify(y.store[n])))c[p][h.CORE]&&delete c[p];Object.keys(c).length&&(t.components[n]=c)}return t}())a.hasOwnProperty(n)&&(i[n]=a[n]);t=JSON.stringify(i)}else t="{}",p.masterSystemNotFound();return t}s.prototype=[],y.store={};var b=function(e){m.getSchema(e)||-1!==a.indexOf(e)?(y.store[e]={},this.name=e,-1===a.indexOf(e)&&g.push(e)):p.invalidCollectionName(e)};b.prototype.find=function(e){var t=new s,n={},r="",a={};if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(r in y.store[this.name])c(e,a=y.store[this.name][r])&&void 0===n[r]&&(t.push(a),n[r]=!0)}.bind(this));else for(r in y.store[this.name])c(e,a=y.store[this.name][r])&&t.push(a);else for(r in y.store[this.name])a=y.store[this.name][r],t.push(a);return t},b.prototype.insert=function(e){var t=[],o=null,i=[];return Array.isArray(e)?t=e:t.push(e),t.forEach(function(e){var t=null,n=[];switch(!0){case"_Schema"===this.name:case"_Logger"===this.name:case"_Model"===this.name:case"_Type"===this.name:case"_GeneratedModel"===this.name:case m.isValidObject(e,m.getModel(this.name)):if(void 0===e[h.ID]&&(e[h.ID]=u.generateId()),m.prepareObject(e,m.getModel(this.name)),y.store[this.name][e[h.ID]]=e,(o=l.get(this.name))?(t=new o(e),i.push(t.id())):(y.createLog("insert",this.name,e[h.ID],"",e),u.isRuntime()&&u.getRuntime().require("db")&&u.getRuntime().require("db").insert({collection:this.name,document:e})),"_Message"===this.name&&u.isRuntime())for(var r=(n=y._Channel.find({})).length,a=0;a<r;a++)u.getRuntime().require(n[a][h.ID]),f.process({component:n[a][h.ID],state:e.event,data:e.data});break;default:p.invalidDocumentOnDbInsert(e,this.name)}}.bind(this)),i},b.prototype.update=function(e,t,n){var r=this.find(e),a=0,o=0,i=r.length,s="",d=m.getModel(this.name),c="";if(void 0===(n=n||{}).upsert&&(n.upsert=n.upsert||!1),t)for(0===i&&n.upsert&&(e[h.ID]&&(t[h.ID]=e[h.ID]),this.insert(t),a+=1),o=0;o<i;o++)for(s in void 0!==t[h.ID]&&t[h.ID]!==r[o][h.ID]&&p.updateUuid(r[o][h.ID],t[h.ID],void 0!==l.get(t[h.ID])),t)void 0!==r[o][s.split(".")[0]]&&("_Schema"!==this.name&&"_Model"!==this.name&&"_GeneratedModel"!==this.name?(c="",0!==s.indexOf("_")?c=-1!==s.indexOf(".")?m.getModelPathType(this.name,s):d[s].type:h.SCHEMA_DEFINITION[s]&&(c=h.SCHEMA_DEFINITION[s].type),c?m.isValidType(t[s],c)?(r[o][s]=t[s],a+=1,y.createLog("update",this.name,r[o][h.ID],s,t[s]),u.isRuntime()&&u.getRuntime().require("db")&&u.getRuntime().require("db").update({collection:this.name,id:r[o][h.ID],field:s,value:t[s]}),"array"===c?f.process({component:r[o][h.ID],state:s,data:[t[s],"reset"]}):f.process({component:r[o][h.ID],state:s,data:[t[s]]})):p.invalidPropertyTypeOnDbUpdate(this.name,r[o][h.ID],s,t[s],c):p.unknownPropertyOnDbUpdate(this.name,s,r[o][h.ID])):(r[o][s]=t[s],y.createLog("update",this.name,r[o][h.ID],s,t[s]),a+=1,u.isRuntime()&&u.getRuntime().require("db")&&u.getRuntime().require("db").update({collection:this.name,id:r[o][h.ID],field:s,value:t[s]})));return a},b.prototype.remove=function(e){var t=[],n="",r=null;if((e=e||null)&&Object.keys(e).length)if(Array.isArray(e))e.forEach(function(e){for(n in y.store[this.name])c(e,y.store[this.name][n])&&(delete y.store[this.name][n],y.createLog("remove",this.name,n,"",""),(r=l.get(n))&&r.destroy(),u.isRuntime()&&u.getRuntime().require("db")&&u.getRuntime().require("db").remove({collection:this.name,id:n}),t.push(n))}.bind(this));else for(n in y.store[this.name])c(e,y.store[this.name][n])&&(delete y.store[this.name][n],y.createLog("remove",this.name,n,"",""),(r=l.get(n))&&r.destroy(),u.isRuntime()&&u.getRuntime().require("db")&&u.getRuntime().require("db").remove({collection:this.name,id:n}),t.push(n));else for(n in y.store[this.name])delete y.store[this.name][n],y.createLog("remove",this.name,n,"",""),-1===o.indexOf(this.name)&&(r=l.get(n))&&r.destroy(),u.isRuntime()&&u.getRuntime().require("db")&&u.getRuntime().require("db").remove({collection:this.name,id:n}),t.push(n);return t},b.prototype.count=function(){var e=0,t="";for(t in y.store[this.name])e++;return e},y.createLog=function(e,t,n,r,a){var o=u.generateId();t=t||"",n=n||"",r=r||"",a=a||"",1e3<Object.keys(y.store._Log).length&&(y.store._Log={}),y.store._Log[o]={_id:o,action:e,collection:t,id:n,field:r,value:a,order:i++}},y.collection=function(e){y[e]=new b(e)},y.importSystem=function(e){return function(e){var t="",n="",r="",a="",o="",i="",s="",d=[];if(e){for(a in e.types)m.type(e.types[a]);for(o in e.schemas)m.schema(e.schemas[o]);for(i in e.models)m.model(e.models[i]);for(s in m.create(),e.behaviors)y._Behavior.insert(e.behaviors[s]);for(n in e.components)for(r in e.components[n])y[n].insert(e.components[n][r]);(d=y._System.find({master:!0})).length&&(d[0][h.ID]===e[h.ID]?e.master=!0:e.master&&(d[0].master=!1)),y._System.insert(e),t=e[h.ID]}return t}(e)},y.exportSystem=function(e){return e?function(e){var t={},n=[],r="",a=0,o=0,i=null,s=null,d=null,c=null,l=null,m="";if((n=y._System.find({master:!0})).length&&(r=n[0].name),t.name=e.name||"sub_"+r,t.version=e.version||"0.0.1",t.description=e.description||"",t.schemas={},e.schemas)for(o=(n=y._Schema.find(e.schema)).length,a=0;a<o;a++)(i=n[a])[h.CORE]||(t.schemas[i[h.ID]]=i);if(t.models={},e.models)for(o=(n=y._Model.find(e.models)).length,a=0;a<o;a++)(d=n[a])[h.CORE]||(t.models[d[h.ID]]=d);if(t.types={},e.types)for(o=(n=y._Type.find(e.types)).length,a=0;a<o;a++)(s=n[a])[h.CORE]||(t.types[s[h.ID]]=s);if(t.behaviors={},e.behaviors)for(c=y._Behavior.find(e.behaviors),o=n.length,a=0;a<o;a++)(c=n[a]).core||(t.behaviors[c[h.ID]]=c);if(t.components={},e.components)for(m in e.components)if(y[m])for(t.components[m]={},o=(n=y[m].find(e.components[m])).length,a=0;a<o;a++)l=n[a],t.components[m][l[h.ID]]=l;return JSON.stringify(t)}(e):v()},y.clear=function(){var e=0,t=0,n="";for(e=g.length,t=0;t<e;t++)n=g[t],y[n].remove();for(e=a.length,t=0;t<e;t++)n=a[t],y[n].remove()},y.init=function(){var e,t;t=y._System.find({_id:"e89c617b6b15d24"})[0],y.clear(),l.clear(),m.clear(),r.clear(),n.clear(),m.init(),e=y.importSystem(t),l.get(e).start()}},{"./behavior.js":2,"./component.js":3,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./mson.js":8,"./state.js":10,"./workflow.js":11}],5:[function(require,module,exports){(function(global){"use strict";var $db=require("./db.js"),$component=require("./component.js"),$mson=require("./mson.js"),runtimeRef=null,requireRef=null;exports.isRuntime=function(){var e=!1;return $db._Runtime&&$db._Runtime.find().length&&(e=!0),e},exports.getRuntime=function(){var e="",t=$db._Runtime.find();return!runtimeRef&&t[0]&&(e=t[0][$mson.ID],runtimeRef=$component.get(e)),runtimeRef},exports.isOnNode=function(){var e=!1;return"undefined"==typeof window&&void 0!==global&&(e=!0),e},exports.getRequire=function getRequire(){return requireRef||(requireRef=eval("require")),requireRef},exports.generateId=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16)}return(t="abcdefghijklmnopqrstuvwxyz").charAt(Math.floor(Math.random()*t.length))+e()+e()+e();var t},exports.polyfill=function(){void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var e=/function\s([^(]{1,})\(/.exec(this.toString());return e&&1<e.length?e[1].trim():""},set:function(e){}})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./component.js":3,"./db.js":4,"./mson.js":8}],6:[function(e,t,n){"use strict";var r=e("./metamodel.js"),a=e("./db.js"),o=e("./component.js"),i=e("./mson.js"),s={currentLevel:"warn",level:function(e){return e&&(this.currentLevel=e),this.currentLevel},debug:function(e){"debug"===this.currentLevel&&console.log("runtime: "+e)},info:function(e){"info"!==this.currentLevel&&"debug"!==this.currentLevel||console.info("runtime: "+e)},warn:function(e){"info"!==this.currentLevel&&"warn"!==this.currentLevel&&"debug"!==this.currentLevel||console.warn("runtime: "+e)},error:function(e){console.error("runtime: "+e)}};function d(){var e="",t=[],n=null;return r.getModel("_Logger")&&(t=a._Logger.find()).length?(e=t[0][i.ID],n=o.get(e)?o.get(e):s):n=s,n}n.level=function(e){e},n.unknownProperty=function(e,t){var n="";n=t[i.NAME]?"unknown property '"+e+"' for the definition of '"+t[i.NAME]+"'":"unknown property '"+e+"' for a model",d().warn(n)},n.invalidPropertyType=function(e,t,n){var r=n&&n.constructor?n.constructor.name:typeof n;d().warn("invalid value for property '"+e+"': expected type '"+t+"' instead of type '"+r+"'")},n.invalidEnumValue=function(e,t){d().warn("'"+e+"' is an invalid value for the type enum '"+t+"'")},n.invalidClassName=function(e,t,n){d().warn("invalid component '"+e+"' for a collection: expected a component of class '"+t+"' instead of '"+n+"'")},n.missingProperty=function(e){d().warn("missing property '"+e+"' for a schema or a model")},n.missingImplementation=function(e){d().warn("schema '"+e+"' is missing.")},n.invalidTypeImp=function(e,t){d().error("the property '"+e+"' of the model '"+t+"' is invalid")},n.missingPropertyImp=function(e,t){d().warn("missing property '"+e+"' in the model '"+t+"'")},n.unknownPropertyImp=function(e,t){d().error("the model '"+t+"' has an unknown property '"+e+"'")},n.invalidTypeDefinition=function(e){d().warn("the type '"+e+"' is not valid")},n.invalidPropertyName=function(e,t,n,r,a){var o="",i="";"Function"!==t&&(o=" (class '"+t+"')"),"string"==typeof a?(i=r&&r.constructor?r.constructor.name:typeof r,d().warn("invalid value for property '"+n+"' on component '"+e+"'"+o+": expected type '"+a+"' instead of type '"+i+"'")):(i=a&&a.constructor?a.constructor.name:typeof a,d().warn("invalid value for property '"+n+"' on component '"+o+": expected type 'string' instead of type '"+i+"'"))},n.readOnlyProperty=function(e,t,n){var r="";"Function"!==t&&(r=" (class '"+t+"')"),d().warn("can not set read-only property '"+n+"' on component '"+e+"'"+r)},n.invalidDocumentOnDbInsert=function(e,t){d().warn("invalid document '"+JSON.stringify(e).replace(/,/g,", ")+"' on an insert operation on collection '"+t+"'")},n.invalidPropertyTypeOnDbUpdate=function(e,t,n,r,a){d().warn("invalid type when trying to update the property '"+n+"' of document '"+t+"' (collection '"+e+"') with the value '"+JSON.stringify(r)+"': expected type '"+a+"'")},n.unknownPropertyOnDbUpdate=function(e,t,n){d().warn("unknown property '"+e+"' on an update operation on collection '"+t+"' with component '"+n+"'")},n.unknownMethod=function(e,t){d().warn("try to call an unknown method '"+t+"' for the class '"+e+"'")},n.invalidCollectionName=function(e){d().warn("invalid name for creating the collection '"+e+"': there is no schema '"+e+"' in the metamodel")},n.invalidResultType=function(e,t,n,r,a){var o="";"Function"!==t&&(o=" (class '"+t+"')"),d().warn("invalid type for the result of method '"+n+"' on component '"+e+"'"+o+": expected type '"+r+"' instead of type '"+a+"'")},n.unknownComponent=function(e,t){d().warn("unkown class component '"+e+"' for component '"+t+"'")},n.workflowRestarted=function(){d().warn("runtime has been restarted")},n.invalidParamNumber=function(e,t,n){var r="";"Function"!==t&&(r=" (class '"+t+"')"),d().warn("invalid number of parameters when calling the method '"+n+"' on component '"+e+"'"+r)},n.invalidParamType=function(e,t,n,r){var a="";"Function"!==t&&(a=" (class '"+t+"')"),void 0!==r?d().warn("invalid type for the parameter '"+r+"' when calling the method '"+n+"' on component '"+e+"'"+a):d().warn("invalid type for a parameter when calling the method '"+n+"' on component '"+e+"'"+a)},n.behaviorNotUnique=function(e,t){d().warn("try to add more than one behavior for the state '"+t+"' on class '"+e+"'")},n.invalidStateOn=function(e,t){d().warn("try to add a behavior to an unkwown state '"+t+"' on class '"+e+"'")},n.invalidStateOff=function(e,t){d().warn("try to remove a behavior from an unkwown state '"+t+"' on class '"+e+"'")},n.masterSystemNotFound=function(){d().warn("can not export the database because no system was defined")},n.invalidType=function(e,t,n){var r=e&&t.constructor?t.constructor.name:typeof t;d().warn("invalid value for property '"+e+"': expected type '"+n+"' instead of type '"+r+"'")},n.invalidConfiguration=function(e,t){d().warn("invalid type for '"+JSON.stringify(e)+"': expected '"+t+"'")},n.unknownType=function(e){d().warn("unknown type for value '"+JSON.stringify(e)+"'")},n.unknownPath=function(e,t){d().warn("the path '"+e+"' has an unkown subpath '"+t+"'")},n.canNotYetValidate=function(e,t){d().debug("can not yet validate if the component '"+e+"' is an instance of '"+t+"'")},n.invalidChannelEvent=function(e,t,n){d().warn("invalid type for the message '"+JSON.stringify(e)+"': expected type '"+n+"' for event '"+t+"'")},n.invalidParamNumberMethodOn=function(e,t,n){var r="";"Function"!==t&&(r=" (class '"+t+"')"),d().warn("invalid number of parameters when adding a behavior on method '"+n+"' on component '"+e+"'"+r)},n.updateUuid=function(e,t,n){n?d().warn("try to update a component of id '"+e+"' with the new id '"+t+"' that is already used"):d().warn("try to update a component of id '"+e+"' with the new id '"+t+"'")},n.invalidUseOfComponent=function(e){d().warn("try to change the state of the destroyed component '"+e+"'")},n.invalidSchema=function(e){d().warn("the schema '"+e+"' is not valid, it has been removed from the metamodel")},n.invalidModel=function(e){d().warn("the model '"+e+"' is not valid, it has been removed from the metamodel")},n.invalidParameters=function(e){d().warn("the parameters for creating a component of class '"+e+"' are not compliant with the model")},n.destroyedComponentCall=function(e,t){d().warn("trying to get the property '"+e+"' on the destroyed component '"+t+"'")},n.invalidConctructorParameters=function(e,t){d().warn("the constructor parameter '"+JSON.stringify(e).replace(/,/g,", ")+"' for creating a component of class '"+t+"' is not an object")},n.unknownModel=function(e){d().warn("try get the information of an unknown model '"+e+"'")},n.missingSchema=function(e){d().warn("the schema '"+e+"' is missing")},n.cyclicDependency=function(e){e?d().error("a cyclic inheritance dependency with "+e+" schema has been found, please check the '_inherit' properties of your schemas"):d().error("a cyclic inheritance dependency has been found, please check the '_inherit' properties of your schemas")},n.invalidEnumType=function(e,t,n){var r="";void 0!==n&&n!==typeof e?(r=e&&e.constructor?e.constructor.name:typeof e,d().warn("invalid type for the type '"+t+"': expected type '"+n+"' instead of type '"+r+"'")):d().warn("invalid type for the type '"+t+"'")},n.loadSchema=function(e){d().debug("load schema '"+e+"'")},n.loadModel=function(e){d().debug("load model '"+e+"'")},n.loadType=function(e){d().debug("load type '"+e+"'")},n.compileSchema=function(e){d().debug("compile schema '"+e+"'...")},n.generateModel=function(e){d().debug("generating model '"+e+"'...")},n.checkModel=function(e){d().debug("analyzing model '"+e+"'...")},n.createCollection=function(e){d().debug("'"+e+"' database collection created")},n.createClass=function(e){d().debug("'"+e+"' class created")},n.modelCreationBegin=function(){d().debug("starting model creation...")},n.modelCreationEnd=function(){d().debug("model creation ended")},n.actionInvokeError=function(e,t,n,r){"Function"!==n?d().error("error when running the behavior '"+e+"' on component '"+t+"' (class '"+n+"'): "+r):d().error("error when running the behavior '"+e+"' on component '"+t+"': "+r)},n.invalidSchemaPropertyName=function(e,t){d().warn("invalid name '"+t+"' for schema '"+e+"': a property name can not begin with '_'")},n.invalidSchemaProperty=function(e,t){d().warn("invalid property '"+t+"' for schema '"+e+"': only 'property', 'link', 'collection', 'method' and 'event' are allowed.")},n.invalidPropertyFormat=function(e){d().warn("invalid format for a definition of a property: '"+e+"' is not an object")},n.invalidState=function(e,t){d().warn("invalid state '"+t+"' for the model '"+e+"'")},n.unknownContext=function(e,t){d().warn("invoke the behavior '"+t+"' on the class '"+e+"' without a valid context")}},{"./component.js":3,"./db.js":4,"./metamodel.js":7,"./mson.js":8}],7:[function(e,t,g){"use strict";var h=e("./db.js"),v=e("./log.js"),b=e("./component.js"),c=(e("./workflow.js"),e("./helper.js")),_=e("./mson.js"),O={inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}};function I(e){var t=!0;return-1===_.INTERNAL_NAMES.indexOf(e)&&(t=!1),t}function n(){var e,t,n="",r="",a="",o={},i="",s=null,d=null,c=null,l={},m={},u=[],p=0,y=0,f=0;for(a in O.compiledSchemas){for(n in l={_name:(o=O.compiledSchemas[a])[_.NAME]},void 0!==o[_.CORE]&&(l[_.CORE]=o[_.CORE]),Array.isArray(o[_.INHERIT])&&(l[_.INHERIT]=o[_.INHERIT]),void 0!==o[_.CLASS]&&(l[_.CLASS]=o[_.CLASS]),void 0!==o[_.DESCRIPTION]&&(l[_.DESCRIPTION]=o[_.DESCRIPTION]),o)I(n)||0!==n.indexOf("_")||v.invalidSchemaPropertyName(o[_.NAME],n);for(n in o)switch(!0){case"property"===o[n]:l[n]={type:"any",readOnly:!1,mandatory:!1,default:"",description:n,label:n};break;case"link"===o[n]:l[n]={type:"_Component",readOnly:!1,mandatory:!1,default:"",description:n,label:n};break;case"method"===o[n]:l[n]={params:[{name:"param1",type:"any",mandatory:!1,default:null},{name:"param2",type:"any",mandatory:!1,default:null},{name:"param3",type:"any",mandatory:!1,default:null}],result:"any",description:n};break;case"event"===o[n]:l[n]={params:[{name:"param1",type:"any",mandatory:!1,default:null},{name:"param2",type:"any",mandatory:!1,default:null},{name:"param3",type:"any",mandatory:!1,default:null}],description:n};break;case"collection"===o[n]:l[n]={type:["_Component"],readOnly:!1,mandatory:!1,default:[],description:n,label:n};break;default:I(n)||v.invalidSchemaProperty(o[_.NAME],n)}O.generatedModels[l[_.NAME]]=l}for(i in O.generatedModels)r=(l=O.generatedModels[i])[_.NAME],(d=O.models[r])&&(m=C(d,l),O.generatedModels[r]=m);for(e=(t=function(){var t=[],n={},e="",r=0;for(e in O.inheritanceTree)r=O.inheritanceTree[e].length,void 0===n[r]&&(n[r]=[]),n[r].push(e);return Object.keys(n).sort().forEach(function(e){n[e].forEach(function(e){t.push(e)})}),t}()).length,y=0;y<e;y++)if(i=t[y],l=O.generatedModels[i]){(u=g.getParents(i)).reverse();JSON.parse(JSON.stringify(l));for(p=u.length,f=0;f<p;f++)r=u[f],(s=O.generatedModels[r])&&(m=C(s,l),O.generatedModels[i]=m);(d=O.models[i])&&(m=C(d,O.generatedModels[i]),O.generatedModels[i]=m)}for(i in O.generatedModels)c=O.generatedModels[i],h._GeneratedModel.insert(c),c[_.CORE]||v.generateModel(i)}function r(){var e="",t=[];function a(e,t){var n,r=0,a=[];for(n=t.length,r=0;r<n;r++)0===t[r].indexOf(e)&&((a=t[r]).reverse(),a.pop(),a.reverse(),t[r]=a)}function o(e,t){var n,r=!0,a=0;for(n=t.length,a=0;a<n;a++)0<t[a].indexOf(e)&&(r=!1);return r}function s(e){var t,n=0,r=[];for(t=e.length,n=0;n<t;n++)if(o(e[n][0],e)){r.push(e[n][0]),a(e[n][0],e);break}return r}function d(e){var t,n,r,a,o=[],i=0;for(Array.isArray(O.inheritance[e])?o=O.inheritance[e].slice():v.missingSchema(e),t=o.length,i=0;i<t;i++)if(n=e,r=o[i],a=void 0,a=!1,Array.isArray(O.inheritance[r])&&-1!==O.inheritance[r].indexOf(n)&&(v.cyclicDependency(n),a=!0),a){o=[];break}return o.length?[e].concat(function(e){var t=[],n=[];for(n=s(e);void 0!==n[0];)t=t.concat(n),n=s(e);return function(e){var t,n=0,r=!0;for(t=e.length,n=0;n<t;n++)e[n].length&&(r=!1);return r}(e)||v.cyclicDependency(),t}(o.map(d).concat([o]))):[e]}for(e in O.inheritance)(t=d(e).reverse()).pop(),t.length&&(O.inheritanceTree[e]=t)}function a(e){var t={},n=O.schemas[e],r=O.inheritanceTree[e],a=0,o=0,i=null,s="";for(r&&(a=r.length,r.reverse()),o=0;o<a;o++)for(s in i=O.schemas[r[o]])0!==s.indexOf("_")&&(t[s]=i[s]);for(s in n)t[s]=n[s];return t}function o(e,t){var n="";for(n in t)n!==_.ID&&n!==_.NAME&&n!==_.DESCRIPTION&&n!==_.INHERIT&&n!==_.CLASS&&n!==_.CORE&&(void 0!==e[n]?i(e[n],t[n])||v.invalidTypeImp(n,e[_.NAME]):v.missingPropertyImp(n,e[_.NAME]));for(n in e)n!==_.ID&&n!==_.NAME&&n!==_.DESCRIPTION&&n!==_.INHERIT&&n!==_.CLASS&&n!==_.CORE&&void 0===t[n]&&v.unknownPropertyImp(n,e[_.NAME])}function i(e,t){return j(t,"string")&&-1!==_.DEFAULT_TYPES.indexOf(t)?j(e,t):s(e,t)}function s(e,t){var n=!0,r=O.type[t],a=0,o=0;if(j(r,"undefined"))n=!1;else if(j(e,"undefined"))n=!1;else if("array"===r.type)for(a=e.length,o=0;o<a&&!1!==(n=j(r.schema,"undefined")?g.isValidType(e[o],r.type):g.isValidSchema(e[o],r.schema));o++);else n=j(r.schema,"undefined")?g.isValidType(e,r.type):g.isValidSchema(e,r.schema);return n}function k(e){return e.trim()}function S(e){return j(e,"string")&&-1===_.DEFAULT_TYPES.indexOf(e)&&!g.isClassName(e)}function w(e){var t="";return t=Array.isArray(e)?"array":typeof e,"any"===e&&(t="any"),t}function N(e){return e&&e.constructor?e.constructor.name:typeof e}function f(e,t){return-1!==t.indexOf(e)}function j(e,t){var n=!0,r=null;switch(t){case"array":n=Array.isArray(e);break;case"date":"string"==typeof e?(r=new Date(e),n=!isNaN(r.getDate())):n=e instanceof Date;break;case"any":n=!0;break;default:n=t===typeof e}return n}function d(e,t,n){var r=!1,a=O.generatedModels[t];return a&&a[_.NAME]&&(a=O.compiledSchemas[a[_.NAME]]),a&&a[e.split(".")[0]]===n&&(r=!0),r}function C(e,t,n){var r="",a=t;for(r in e)e.hasOwnProperty(r)&&0!==r.indexOf("_")&&(a[r]=e[r]);return a}function l(e,t,n){var r=null,a=[],o="";switch(!0){case"=>"===e:break;case"string"==typeof t&&"boolean"===t:r=n?{name:e,type:"boolean",mandatory:!1,default:!1}:{type:"boolean",readOnly:!1,mandatory:!1,default:!1};break;case"string"==typeof t&&"string"===t:r=n?{name:e,type:"string",mandatory:!1,default:""}:{type:"string",readOnly:!1,mandatory:!1,default:""};break;case"string"==typeof t&&"number"===t:r=n?{name:e,type:"number",mandatory:!1,default:0}:{type:"number",readOnly:!1,mandatory:!1,default:0};break;case"string"==typeof t&&"object"===t:r=n?{name:e,type:"object",mandatory:!1,default:{}}:{type:"object",readOnly:!1,mandatory:!1,default:{}};break;case"string"==typeof t&&"array"===t:r=n?{name:e,type:"array",mandatory:!1,default:[]}:{type:"array",readOnly:!1,mandatory:!1,default:[]};break;case"string"==typeof t&&"date"===t:r=n?{name:e,type:"date",mandatory:!1,default:"1970-01-01T00:00:00.000Z"}:{type:"date",readOnly:!1,mandatory:!1,default:"1970-01-01T00:00:00.000Z"};break;case"string"==typeof t&&"any"===t:r=n?{name:e,type:"any",mandatory:!1,default:null}:{type:"any",readOnly:!1,mandatory:!1,default:""};break;case"string"==typeof t:o={},(a=h._Type.find({name:t})).length&&a[0].value&&(o=a[0].value[0]),h._Schema.find({_name:t}).length&&(o=""),r=n?{name:e,type:t,mandatory:!1,default:o}:{type:t,readOnly:!1,mandatory:!1,default:o};break;case"array"==typeof t&&"boolean"==typeof t[0]:r=n?{name:e,type:["boolean"],mandatory:!1,default:[]}:{type:["boolean"],readOnly:!1,mandatory:!1,default:[]};break;case"array"==typeof t&&"string"==typeof t[0]:r=n?{name:e,type:["string"],mandatory:!1,default:""}:{type:["string"],readOnly:!1,mandatory:!1,default:""};break;case"array"==typeof t&&"number"==typeof t[0]:r=n?{name:e,type:["number"],mandatory:!1,default:[]}:{type:["number"],readOnly:!1,mandatory:!1,default:[]};break;case"array"==typeof t&&"object"==typeof t[0]:r=n?{name:e,type:["object"],mandatory:!1,default:[]}:{type:["object"],readOnly:!1,mandatory:!1,default:[]};break;case"array"==typeof t&&"date"==typeof t[0]:r=n?{name:e,type:["date"],mandatory:!1,default:[]}:{type:["date"],readOnly:!1,mandatory:!1,default:[]};break;case"array"==typeof t&&"any"==typeof t[0]:r=n?{name:e,type:["any"],mandatory:!1,default:[]}:{type:["any"],readOnly:!1,mandatory:!1,default:[]};break;case"array"==typeof t:r=n?{name:e,type:t,mandatory:!1,default:[]}:{type:t,readOnly:!1,mandatory:!1,default:[]}}return r}function m(e){var t="",n="",r={};for(t in e=JSON.parse(JSON.stringify(e)))if(e.hasOwnProperty(t)&&0!==t.indexOf("_"))switch(!0){case"string"==typeof e[t]:e[t]=l(t,e[t],!1);break;case"object"==typeof e[t]&&void 0===e[t]["=>"]:e[t]=C(e[t],l(t,e[t].type||"any",!1));break;case"object"==typeof e[t]&&void 0!==e[t]["=>"]:for(n in r={params:[],result:"any"},e[t])"string"==typeof e[t][n]&&("=>"===n?r.result=e[t][n]:r.params.push(l(n,e[t][n],!0))),"object"==typeof e[t][n]&&r.params.push(C(e[t][n]),l(n,e[t][n].type||"any",!0));e[t]=r}return e}g.schema=function(e,t){var n,r,a,o=null,i="",s={},d=[];return void 0===t||0===Object.keys(t).length?"string"==typeof e?(t={},i=t[_.NAME]=e):(t=JSON.parse(JSON.stringify(e)),i=t[_.NAME]):(t=JSON.parse(JSON.stringify(t)),t[_.NAME]=e,i=t[_.NAME]),void 0===t[_.ID]&&(t[_.ID]=c.generateId()),void 0===t[_.INHERIT]&&(t[_.INHERIT]=["_Component"]),t[_.INHERIT]=(n=t[_.INHERIT],r=[],a={},n.forEach(function(e){var t=e.trim();void 0===a[t]&&(a[t]=t,r.push(t))}),r),g.isValidObject(t,_.SCHEMA_DEFINITION,!1)?(d=h._Schema.find({_name:i})).length?(s=C(t,d[0]),h._Schema.update({_name:i},s),o=d[0][_.ID]):o=h._Schema.insert(t)[0]:v.invalidSchema(t[_.NAME]),o},g.model=function(e,t){var n=null,r="",a={},o=[];return void 0===t||0===Object.keys(t).length?t=JSON.parse(JSON.stringify(e)):(t=JSON.parse(JSON.stringify(t)),t[_.NAME]=e,t=m(t)),r=t[_.NAME],void 0===t[_.ID]&&(t[_.ID]=c.generateId()),g.isValidObject(t,_.MODEL_DEFINITION,!1)?(o=h._Model.find({_name:r})).length?(a=C(t,o[0]),h._Model.update({_name:r},a),n=o[0][_.ID]):n=h._Model.insert(t)[0]:v.invalidModel(t[_.NAME]),n},g.type=function(e,t){var n=null,r="",a={};return void 0===t||0===Object.keys(t).length?r=(a=JSON.parse(JSON.stringify(e))).name:(Array.isArray(t)?(t=JSON.parse(JSON.stringify(t)),a.value=t,a.name=e,a.type=typeof t[0]||"any"):(t=JSON.parse(JSON.stringify(t)),a.schema=m(t),a.name=e,a.type="object"),r=a.name),void 0===a[_.ID]&&(a[_.ID]=c.generateId()),g.isValidObject(a,_.TYPE_DEFINITION)?n=h._Type.insert(a)[0]:v.invalidTypeDefinition(r),n},g.init=function(){g.clear(),h.collection("_Logger"),h.collection("_Schema"),h.collection("_Model"),h.collection("_GeneratedModel"),h.collection("_ClassInfo"),h.collection("_Behavior"),h.collection("_State"),h.collection("_Type"),h.collection("_Message"),h.collection("_Channel"),h.collection("_Log")},g.clear=function(){O={inheritance:{},inheritanceTree:{},schemas:{},compiledSchemas:{},models:{},generatedModels:{},states:{},type:{}}},g.create=function(){v.modelCreationBegin(),function(){var e,t,n,r=null,a={},o=null,i="",s="",d=0,c=0;for(O.inheritance={},O.inheritanceTree={},O.schemas={},O.compiledSchemas={},O.models={},O.generatedModels={},O.states={},O.type={},c=(e=h._Schema.find({})).length,d=0;d<c;d++)i=(r=e[d])[_.NAME],s=r[_.INHERIT],O.schemas[i]=r,s&&(O.inheritance[i]=s),r[_.CORE]||v.loadSchema(i);for(c=(n=h._Model.find({})).length,d=0;d<c;d++)i=(a=n[d])[_.NAME],(O.models[i]=a)[_.CORE]||v.loadModel(i);for(c=(t=h._Type.find({})).length,d=0;d<c;d++)o=t[d],(O.type[o.name]=o).core||v.loadType(o.name)}(),r(),function(){var e="";for(e in O.schemas)O.schemas[e][_.CORE]||v.compileSchema(e),O.compiledSchemas[e]=a(e)}(),n(),function(){var e="",t=null,n="";for(e in O.generatedModels)(t=O.generatedModels[e])&&((n=O.compiledSchemas[e])?(t[_.CORE]||v.checkModel(e),o(t,n)):v.missingImplementation(e))}(),function(){var e="",t=null,n="",r=[],a="";for(e in O.compiledSchemas){if(r=[],t=O.compiledSchemas[e])for(a in t)n=t[a],0!==a.indexOf("_")&&-1!==_.INTERNAL_TYPES.indexOf(n)&&r.push(a);O.states[e]=r}}(),function(){var e="",t={};for(e in O.generatedModels)t=O.generatedModels[e],void 0===h[t[_.NAME]]&&!1!==t[_.CLASS]&&(h.collection(t[_.NAME]),t[_.CORE]||v.createCollection(t[_.NAME]))}(),function(){var e="",t={};for(e in O.generatedModels)!1!==(t=O.generatedModels[e])[_.CLASS]&&(b.create({model:e}),t[_.CORE]||v.createClass(e))}(),function(){var e="",t={},n="";for(e in O.generatedModels)n=(t=O.generatedModels[e])[_.NAME]+"Info",!1!==t[_.CLASS]&&g.inheritFrom(t[_.NAME],"_Component")&&(b.get(n)?h._ClassInfo.update({_id:n},{_id:n,schema:O.compiledSchemas[e],model:t}):h._ClassInfo.insert({_id:n,schema:O.compiledSchemas[e],model:t}))}(),v.modelCreationEnd()},g.isEvent=function(e,t){return d(e,t,_.EVENT_TYPE)},g.isProperty=function(e,t){return d(e,t,_.PROPERTY_TYPE)},g.isLink=function(e,t){return d(e,t,_.LINK_TYPE)},g.isCollection=function(e,t){return d(e,t,_.COLLECTION_TYPE)},g.isMethod=function(e,t){return d(e,t,_.METHOD_TYPE)},g.isStructure=function(e,t){var n,r=!1,a=null;return n=g.getModelPathType(t,e),(a=Array.isArray(a)?g.getType(n[0]):g.getType(n))&&a.schema&&(r=!0),r},g.isValidState=function(e,t){var n=!1,r=O.generatedModels[t],a={};return-1!==e.indexOf(".")?n=g.isValidModelPath(t,e):(r&&r[_.NAME]&&(r=O.generatedModels[r[_.NAME]]),a=O.states[r[_.NAME]],Array.isArray(a)&&(n=-1!==a.indexOf(e))),n},g.isValidType=function(e,t){var n,r,a,o,i=!0;switch(!0){case S(t):(i=s(e,t))||(O.type[t]?v.invalidEnumType(e,t,O.type[t].type):v.invalidEnumType(e,t)),i&&(n=e,r=t,a=O.type[r],o=!0,Array.isArray(a.value)&&-1===a.value.indexOf(n)&&(o=!1),!1===o&&v.invalidEnumValue(n,r),i=o);break;case g.isClassName(t):""!==e&&null!==e&&(i=g.inheritFrom(N(e),t));break;default:i=function(e,t){var n=!0,r=0,a=0;switch(w(t)){case"string":n=j(e,t);break;case"array":if(Array.isArray(e))for(a=e.length,r=0;r<a;r++)switch(!0){case S(t[0]):n=s(e[r],t[0]);break;case g.isClassName(t[0]):""!==e[r]&&null!==e[r]&&(n=g.inheritFrom(N(e[r]),t[0]));break;default:n=j(e[r],t[0])}else n=!1}return n}(e,t)}return i},g.isValidEnum=function(e,t){var n,r,a,o=!0;return g.isClassName(t.type)?(n=b.get(e),r=k(t.type),a="","Function"===(a=n.constructor.name)&&(a=n.name),(o=a===r&&-1!==t.value.indexOf(e))||v.invalidEnumValue(e,t.type)):(o=j(e,t.type)&&-1!==t.value.indexOf(e))||v.invalidEnumValue(e,t.name),o},g.isValidSchema=function n(r,e){var t,a,o="",i=null,s=!0,d="",c="",l="",m=0,u=0;function p(){var e=!0,t=[];switch(c=d.replace("{","").replace("}","").trim(),c=r[c],!0){case"string"==typeof c:S(c)?O.type[c]?O.type[c].schema?e=n(i,O.type[c].schema):(e=j(i,O.type[c].type),(t=O.type[c].value)&&(e=f(i,t))):e=!1:e="array"===c?Array.isArray(i):g.isClassName(c)?j(i,"object")||j(i,"string"):j(i,c);break;case Array.isArray(c):Array.isArray(i)||(e=!1);break;default:e=!1}return e||v.invalidPropertyType(o,c,i),e}function y(){var e=!0;switch(l=w(d)){case"string":if(S(l))e=n(i,d);else if(!j(i,d)){v.invalidPropertyType(o,d,i),e=!1;break}break;case"array":if(Array.isArray(i)){for(m=i.length,u=0;u<m;u++)if(S(d[0]))e=n(i[u],O.type[d[0]].schema);else if(!j(i[u],d[0])){v.invalidPropertyType(o,d[0],i[u]),e=!1;break}}else e=!1}return e}if(j(r,"object")){for(o in r){if(i=r[o],j(e[o],"undefined"))return v.unknownProperty(o,e),!1;switch(d=e[o].type,!0){case g.isClassName(d):s=s&&(t=!(a=t=void 0),a=[],c=N(d),S(c=r[c])?O.type[c]?O.type[c].schema?t=n(i,O.type[c].schema):(t=j(i,O.type[c].type),(a=O.type[c].value)&&(t=f(i,a))):t=!1:t="array"===c?Array.isArray(i):g.isClassName(c)?j(i,"object")||j(i,"string"):j(i,c),t||v.invalidPropertyType(o,c,i),t);break;case-1!==d.indexOf("{"):s=s&&p();break;default:s=s&&y()}if(!s)break}for(o in e)if(!0===(i=e[o]).mandatory&&j(r[o],"undefined")&&void 0!==r[o]){v.missingProperty(o),s=!1;break}}else s=!1,v.invalidPropertyFormat(r);return s},g.isValidObject=function o(i,e,s,d){var c="",t=null,n=!0,r=!0,a="",l="",m="",u=0,p=0;function y(e,t){var n,r=!0;if(n=O.type[t])switch(!0){case!j(n.schema,"undefined"):r=o(e,n.schema,s,d);break;case!j(n.value,"undefined"):r=g.isValidEnum(e,n);break;default:r=g.isValidType(e,n.type)}else r=!1;return r}function f(e,t){var n=!0,r=null,a=!1;if(l=k(t),e&&e.id?(r=e,a=!0):r=b.get(e),j(r,"undefined"))switch(!0){case j(e,"object")&&null!==e&&0<Object.keys(e).length:case j(e,"string")&&""!==e:v.canNotYetValidate(e,l)}else g.inheritFrom(r.constructor.name,l)?a&&d&&(i[c]=r.id()):(n=!1,v.invalidType(c,e,l));return n}function h(e,t){var n=!0,r=null,a="";switch(m=w(t)){case"any":break;case"string":if(S(m))n=o(e,t,s,d);else if("array"===t){if("array"!==w(e)){v.invalidPropertyType(c,t,e),n=!1;break}}else if("date"===t){if(r=new Date(e),!(n=!isNaN(r.getDate()))){v.invalidPropertyType(c,t,e);break}}else if(w(e)!==t&&"any"!==w(e)){v.invalidPropertyType(c,t,e),n=!1;break}break;case"array":if(Array.isArray(e)){for(u=e.length,a=t[0],p=0;p<u;p++)if(S(a))n=y(e[p],a);else if(g.isClassName(a))if("string"===w(e[p]))if(b.get(e[p])){if(!g.inheritFrom(N(b.get(e[p])),k(a))){v.invalidClassName(JSON.stringify(e[p]),k(a),N(b.get(e[p]))),n=!1;break}}else""!==e[p]&&v.canNotYetValidate(e[p],k(a));else{if(!g.inheritFrom(N(e[p]),k(a))){v.invalidClassName(JSON.stringify(e[p]),k(a),N(e[p])),n=!1;break}d&&(e[p]=e[p].id())}else if(w(e[p])!==a&&"any"!==a){v.invalidPropertyType(c,a,e[p]),n=!1;break}}else n=!1,v.invalidType(c,e,"array");break;default:n=!1,v.unknownType(e)}return n}for(c in j(s,"undefined")&&(s=!0),j(d,"undefined")&&(d=!1),j(i,"object")||(n=!1,v.invalidConfiguration(i,"object")),i)if(t=i[c],j(e[c],"undefined")&&c!==_.CORE&&c!==_.ID){if(s)return v.unknownProperty(c,e),!1}else{switch(!0){case c===_.CORE:a="boolean";break;case c===_.ID:a="string";break;default:a=e[c].type}switch(!0){case S(a):n=n&&y(t,a);break;case g.isClassName(a):n=n&&f(t,a);break;default:n=n&&h(t,a)}}for(c in e)r=(t=e[c]).mandatory,i&&j(i[c],"undefined")&&!0===r&&(v.missingProperty(c),n=!1);return n},g.prepareObject=function(e,t){var n="",r=null,a=!0,o="";for(n in t=JSON.parse(JSON.stringify(t)))a=(r=t[n]).mandatory,o=r.default,j(e[n],"undefined")&&(!1!==a||j(o,"undefined")||(e[n]=o))},g.getSchema=function(e){var t=null;return O.compiledSchemas[e]&&(t=O.compiledSchemas[e]),t},g.getModel=function(e){var t=null;return O.generatedModels[e]&&(t=O.generatedModels[e]),t},g.getType=function(e){var t=null;return O.type[e]&&O.type[e]&&(t=JSON.parse(JSON.stringify(O.type[e]))),t},g.getModelPathType=function(e,t){var n,r,a=null,o="",i=0,s="";for(r=(n=t.split(".")).length,i=0;i<r;i++)if(o=(o=n[i]).split("[")[0],0===i)a=g.getModel(e)[o].type;else if(Array.isArray(a)&&(a=a[0]),S(a))switch(s=g.getType(a),!0){case void 0!==s.schema:s.schema[o]?a=s.schema[o].type:v.unknownPath(t,o);break;case void 0!==s.type:a=s.type;break;default:v.invalidState(e,t)}return a},g.isValidModelPath=function(e,t){var n,r,a=!0,o=null,i="",s=0,d="";for(r=(n=t.split(".")).length,s=0;s<r;s++)i=(i=n[s]).split("[")[0],0===s?(o=g.getModel(e)[i].type)||(a=!1):(Array.isArray(a)&&(o=o[0]),S(o)&&(d=g.getType(o)).schema&&d.schema[i]&&((o=d.schema[i].type)||(a=!1)));return a},g.getParents=function(e){return O.inheritanceTree[e]?O.inheritanceTree[e].slice():[]},g.inheritFrom=function(e,t){var n=!1,r=[],a=0,o=0;function i(e,t){var n=!1,r=[],a=0;if(0!==(r=g.getParents(e)).length)if(-1!==r.indexOf(t))n=!0;else for(a=0;a<0&&!(n=i(r[a],t));a++);return n}if(e!==t){if(o=(r=g.getParents(e)).length,0!==r.length)if(-1!==r.indexOf(t))n=!0;else for(a=0;a<o&&!(n=i(r[a],t));a++);}else n=!0;return n},g.isClassName=function(e){var t=j(e,"string");return t&&(t=0<Object.keys(O.generatedModels).length&&void 0!==O.generatedModels[e]),t}},{"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./mson.js":8,"./workflow.js":11}],8:[function(e,t,n){"use strict";n.ID="_id",n.NAME="_name",n.DESCRIPTION="_description",n.INHERIT="_inherit",n.CLASS="_class",n.CORE="_core",n.INTERNAL_NAMES=["_id","_name","_inherit","_description","_class","_core"],n.PROPERTY_TYPE="property",n.COLLECTION_TYPE="collection",n.LINK_TYPE="link",n.METHOD_TYPE="method",n.EVENT_TYPE="event",n.INTERNAL_TYPES=["property","collection","link","method","event"],n.DEFAULT_TYPES=["boolean","string","number","object","function","array","date","any"],n.SCHEMA_DEFINITION={_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1,default:["_Component"]},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}},n.MODEL_DEFINITION={_id:{type:"string",mandatory:!0},_name:{type:"string",mandatory:!0},_inherit:{type:["string"],mandatory:!1},_class:{type:"boolean",mandatory:!1},_core:{type:"boolean",mandatory:!1},_description:{type:"string",mandatory:!1}},n.TYPE_DEFINITION={_id:{type:"string",mandatory:!0},name:{type:"string",mandatory:!0},type:{type:"string",mandatory:!0},schema:{type:"object",mandatory:!1},value:{type:["any"],mandatory:!1},core:{type:"boolean",mandatory:!1},description:{type:"string",mandatory:!1}}},{}],9:[function(e,t,n){"use strict";var r,a=e("./db.js"),o=e("./component.js"),i=e("./metamodel.js"),s=e("../build/system/system.js"),d="",c=null;e("./helper.js").polyfill(),i.init(),r=a.importSystem(s.system),d=o.get(r),c=o.get("channel"),d.state("installed"),c.$systemInstalled(r),d.state("resolved"),c.$systemResolved(r),d.state("starting"),c.$systemStarted(r),d.start(),d.state("active"),t.exports=o.get("runtime")},{"../build/system/system.js":1,"./component.js":3,"./db.js":4,"./helper.js":5,"./metamodel.js":7}],10:[function(e,t,n){"use strict";var r=e("./db.js"),a={};n.set=function(e,t,n){a[e]={state:t,value:n},r.store._State[e]={state:t,value:n}},n.get=function(e){return a[e]},n.clear=function(){a={}}},{"./db.js":4}],11:[function(e,t,h){"use strict";var g=e("./metamodel.js"),v=e("./component.js"),b=e("./behavior.js"),_=e("./state.js"),l=e("./helper.js"),O=e("./log.js"),I=e("./db.js");function m(e){this.message=e,this.name="RuntimeError"}function f(e){return-1!==e.indexOf(".")}function k(e,t){var n=null,r=[],a=[],o=0,i=0,s=0,d=0;if(g.getModel(e)?n=g.getModel(e)[t]:O.unknownModel(e),n){if(r=n.params)for(o=r.length,i=0;i<o;i++)void 0!==r[i].mandatory&&!0!==r[i].mandatory||(s+=1),d+=1;a.push(s),a.push(d)}else-1===t.indexOf("[")&&-1===t.indexOf(".")&&O.unknownMethod(e,t);return a}function S(t,n,e,r,a){var o=null,i=[],s="",d=0,c=0;s="Function"===t.constructor.name?t.name:t.constructor.name,g.isProperty(n,s)||g.isLink(n,s)||g.isCollection(n,s)||(r=function(e,t,n){var r,a=[],o=[],i=0,s=0;if(r=g.getModel(e)[t]){if(a=r.params)for(i=a.length,s=0;s<i;s++)!1===a[s].mandatory&&void 0===n[s]?o.push(a[s].default):o.push(n[s])}else-1===t.indexOf("[")?O.unknownMethod(e,t):o=n;return o}(s,n,r));try{for(c=r.length,d=0;d<c;d++)i.push(r[d]);e.useCoreAPI&&(i.push(v),i.push(I),i.push(g),i.push(h),i.push(b),i.push(_),i.push(O),i.push(l)),l.isOnNode()&&i.push(l.getRequire()),a?e.context?setTimeout(e.action.bind.apply(e.action,[e.context].concat(i)),0):setTimeout(e.action.bind.apply(e.action,[t].concat(i)),0):o=e.context?e.action.apply(e.context,i):e.action.apply(t,i)}catch(e){if(e instanceof m)throw e;void 0===new Function?console.error("runtime: can not execute new Function() instruction in the current context."):(t&&t.error&&t.error({message:"error when running the behavior '"+n+"' on component '"+t.id()+"'",error:e}),l.getRuntime()&&l.getRuntime().error({message:"error when running the behavior '"+n+"' on component '"+t.id()+"'",error:e}),O.actionInvokeError(n,t.id(),t.constructor.name,e.message))}return o}(m.prototype=new Error).constructor=m,h.checkInputNumbers=function(e,t,n){var r,a,o,i,s,d="",c="",l=[],m=[],u=!1;switch(r=(d=n.toString()).indexOf("{"),""===(l=(-1!==(c=(c=d.substring(0,r)).replace("=>","")).indexOf("(")?c.split("(")[1].replace(")","").trim():c.trim()).split(","))[0]&&(l=[]),a=l.length,o=g.isProperty(t,e),i=g.isLink(t,e),s=g.isCollection(t,e),!0){case s:m=[2,2];break;case o:m="array"===g.getModelPathType(e,t)?[2,2]:[1,1];break;case i:m=[1,1];break;default:m=k(e,t)}return m[0]<=a&&a<=m[1]&&(u=!0),u},h.checkInput=function(e){var t,n,r,a,o=(e=e||{}).component||null,i=e.methodName||"",s=e.args||"",d=[],c=[],l="",m=s.length,u=0,p=null,y=!0;switch(l="Function"===o.constructor.name?o.name:o.constructor.name,n=g.isProperty(i,l),r=g.isLink(i,l),a=g.isCollection(i,l),t=function(e,t){var n=null,r=[],a=[],o=0,i=0;if(g.getModel(e)?n=g.getModel(e)[t]:O.unknownModel(e),n){if(r=n.params)for(o=r.length,i=0;i<o;i++)a.push(r[i].name)}else f(t)||O.unknownMethod(e,t);return a}(l,i),!0){case a&&-1===i.indexOf("."):d=s&&s[1]&&"reset"===s[1]?[[g.getModel(l)[i].type[0]],"string"]:[g.getModel(l)[i].type[0],"string"],c=[2,2];break;case n&&-1===i.indexOf("."):d=f(i)?[g.getModelPathType(l,i)]:[g.getModel(l)[i].type],"array"===g.getModelPathType(l,i)?(d=s&&s[1]&&"reset"===s[1]?[["any"],"string"]:["any","string"],c=[2,2]):c=[1,1];break;case r&&-1===i.indexOf("."):d=[g.getModel(l)[i].type],c=[1,1];break;default:d=function(e,t){var n=null,r=[],a=[],o=0,i=0;if(g.getModel(e)?n=g.getModel(e)[t]:O.unknownModel(e),n){if(r=n.params)for(o=r.length,i=0;i<o;i++)a.push(r[i].type)}else-1===t.indexOf("[")&&-1===t.indexOf(".")&&O.unknownMethod(e,t);return a}(l,i),c=k(l,i)}for(void 0===m&&(m=1),(m<c[0]||c[1]<m)&&(y=!1,O.invalidParamNumber(o.id(),o.constructor.name,i)),u=0;u<m;u++)if(void 0===(p=s[u])){if(!(u<c[0]))continue;y=!1,O.invalidParamNumber(o.id(),o.constructor.name,i)}else g.isValidType(p,d[u])||(y=!1,O.invalidParamType(o.id(),o.constructor.name,i,t[u]));return y},h.checkOutput=function(e){var t,n,r,a,o=(e=e||{}).component||null,i=e.methodName||"",s=null,d="",c=null,l=!0;return s=void 0!==e.methodResult?e.methodResult:void 0,d="Function"===o.constructor.name?o.name:o.constructor.name,t=d,n=i,a=r=null,g.getModel(t)?r=g.getModel(t)[n].result:O.unknownModel(t),r&&(a=r),c=a,g.isValidType(s,c)||(l=!1,O.invalidResultType(o.id(),o.constructor.name,i,JSON.stringify(c),Array.isArray(s)?"array":typeof s)),l},h.process=function(e){(e=e||{}).id=e.id||"",e.component=e.component||"",e.state=e.state||"",e.data=e.data||[],e.context=e.context||null;var t,n=null,r=[],a=void 0,o=0,i=0,s=!1,d=!1,c=!1,l=!1,m=!1,u=!1,p=[],y=null,f=null;if((t=_.get(e.component))&&"destroy"===t.state&&O.invalidUseOfComponent(e.component),e.id?0===(p=I._Behavior.find({_id:e.id})).length&&(y=p[0],(n=v.get(y.component))&&(s="Function"===n.constructor.name?n.name:n.constructor.name,d=g.isProperty(y.state,s),c=g.isLink(y.state,s),l=g.isCollection(y.state,s),m=g.isEvent(y.state,s),u=g.isMethod(y.state,s),(f=b.get(e.id))&&(S={useCoreAPI:y.useCoreAPI,context:y.context,action:f},r.push(S)))):(n=v.get(e.component))&&(s="Function"===n.constructor.name?n.name:n.constructor.name,d=g.isProperty(e.state,s),c=g.isLink(e.state,s),l=g.isCollection(e.state,s),m=g.isEvent(e.state,s),u=g.isMethod(e.state,s),r=function e(t,n,r){var a=b.getActions(t.id(),n),o=[],i=0,s=0,d=null;if(!a.length||r)if("Function"!==t.constructor.name)a=a.concat(e(v.get(t.constructor.name),n,r));else for(i=(o=g.getParents(t.name)).length,s=0;s<i&&((d=v.get(o[s]))?a=a.concat(e(d,n,r)):O.unknownComponent(o[s],t.name),!a.length);s++);return a.length&&a.reverse(),a}(n,e.state,m)),r.length){if(h.checkInput({component:n,methodName:e.state,args:e.data}))if(u)a=S(e.context||n,e.state,r[0],e.data,!1),h.checkOutput({component:n,methodName:e.state,methodResult:a});else{for(i=r.length,o=0;o<i;o++)S(e.context||n,e.state,r[o],e.data,!0);_.set(n.id(),e.state,e.data)}}else n&&(m||d||c||l)&&_.set(n.id(),e.state,e.data);return a}},{"./behavior.js":2,"./component.js":3,"./db.js":4,"./helper.js":5,"./log.js":6,"./metamodel.js":7,"./state.js":10}]},{},[9])(9)});